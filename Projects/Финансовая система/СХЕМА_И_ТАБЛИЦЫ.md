# Схема потоков ↔ Таблицы и правила

> **Цель:** за ~1 час разобрать схему, связать её с существующими таблицами и определить первые шаги для проверки правильности и построения структуры работы.

**Как пользоваться этим документом:**
1. Схема (CLEAN_FLOWCHART.html + СХЕМА_ПОТОКОВ_ОПИСАНИЕ.md) — **что должно быть** (потоки, узлы, связи).
2. Ниже — **словарь узлов** (что каждый узел значит в учёте и в какой таблице это есть/должно быть).
3. **Правила из связей** — чек-лист для проверки правильности данных.
4. **План на первый шаг** — 3–5 конкретных действий, чтобы за час продвинуться.

Обновляй колонку «Есть в таблицах» по факту (ДА/НЕТ/ЧАСТИЧНО), дополняй «Где проверять» названиями своих листов.

---

## 1. Словарь узлов: схема → учёт → таблица

Для каждого типа узла схемы: что это в реальном учёте, в каком листе/файле это отражается, есть ли сейчас.

| Блок | Узел на схеме | В учёте это | Где хранить / откуда брать | Есть в таблицах? |
|------|----------------|-------------|----------------------------|------------------|
| 1 | WB / Озон по юрлицам (13 узлов) | Финотчёт площадки: выручка, комиссии, «к поступлению на р/с» | Лист «Маркетплейс» или «Финотчёт WB/Ozon» в файле магазина (full_project_context) | Частично: выгрузки вручную, нет единой структуры |
| 2 | Юрлица (8: DBZ, MN, VAS, LYA, MAKS, LIFE, ALEX, HUB) | Магазин / бренд / ИП; владелец площадок и р/с | Справочник юрлиц (один лист или колонка в Пользователях) | Нет единого справочника; в боте — роли без привязки к юрлицу |
| 3 | Расчётный счёт (8, 1:1 с юрлицами) | Бизнес-банк, один р/с на юрлицо | Лист «Бизнес-банк» / «Баланс счетов»; колонка «Р/с» в операциях | Частично: журналы по магазинам (МН и др.), Баланс счетов |
| 3 | Оплата по безналу, Налоги | Направления расходов с р/с | Категории в журнале операций; лист «Налоги» | Частично: категории в боте (переделать), налоги в архитектуре |
| 4 | Личные карты физлица, Маркет-карта | Карты/счета физлица; вывод р/с → карта / СБП | Лист «Физ.банки» в файле магазина; счета-источник/получатель в транзакции | Частично: в журнале МН банки в столбцах, без явной привязки к юрлицу |
| 5 | Наличные, Сейф, P2P, Оплата сервисов, Зарплата ИП | Варианты использования с карт и с р/с | Листы «Наличные», «Зарплаты»; категории операций | Частично: бот (заявки), касса; нет разбивки по юрлицам |
| 6 | USDT-кошельки (общие), холодный транзит, Карго | Холодные кошельки по назначению; наличные → обмен **через трейдера** (офис); **Bybit** пополняется **через P2P** переводами | USDT-журнал (общий); справочник кошельков | Частично: Крипто-журнал xlsx, листы USDT, USDT Зарплаты, CNY в боте |
| 7 | P2P-платформы, Bybit, HTX | Сервисы обмена и биржи | Не «таблица», а факт операций: откуда пополнение, куда вывод | Нет структурированного учёта |
| 8 | Сотрудники, Поставщики, Прочие | Конечные получатели денег | Справочник сотрудников (имя, реквизиты, статус); контрагенты | Частично: в боте заявки по получателям; единой таблицы сотрудников нет |

**Итог по колонке «Есть в таблицах»:** заполни по факту (ДА/НЕТ/ЧАСТИЧНО). Это и есть твой разбор «как схему использовать» — видно, где данные уже есть, где дырки.

---

## 2. Связи схемы = правила проверки

Каждая связь на схеме задаёт правило, которое можно проверить по данным. Используй как чек-лист правильности.

| № | Правило (из схемы) | Где проверять (лист / колонки / файл) | Статус |
|---|--------------------|----------------------------------------|--------|
| 1 | У каждого юрлица ровно один расчётный счёт (1:1) | Справочник «Юрлицо – Р/с» или лист Бизнес-банк | [ ] есть таблица, [ ] заполнено |
| 2 | Каждая площадка WB/Озон привязана к одному юрлицу | Таблица распределения (как в СХЕМА_ПОТОКОВ_ОПИСАНИЕ: DBZ→WB, VAS→WB+Озон …) | [ ] зафиксировано в одном месте |
| 3 | Сумма «К поступлению» (финотчёт МП) = фактическое поступление на р/с (сверка) | Лист «Сверка» или сравнение финотчёта и выписки по р/с | [ ] процесс есть, [ ] делается регулярно |
| 4 | Операции с р/с отнесены к одному из 5 направлений: безнал, налоги, карты, маркет-карта, наличные | Журнал операций: категория или «направление» | [ ] поля есть, [ ] заполняются |
| 5 | Вывод на карты/маркет-карту привязан к юрлицу (у каждого юрлица свои карты) | В транзакции: юрлицо или «магазин» + счёт-источник | [ ] есть привязка |
| 6 | USDT-кошельки общие; пополнение с сейфа/P2P без дублирования по юрлицам | USDT-журнал: один набор кошельков, при необходимости колонка «источник (юрлицо/сейф)» | [ ] структура понятна |
| 7 | Оплаты сотрудникам идут с P2P (BitPapa и др.); запись о выплате есть | Заявки в боте / лист заявок; при необходимости «источник выплаты» | [ ] можно проследить поток |
| 8 | Каждая одобренная заявка (бот) имеет отражение в журнале расходов | Сверка: заявки (листы Основные/Разные/USDT…) ↔ журнал/факт | [ ] процесс сверки есть |

**Как использовать:** пройди по строкам, отметь «Где проверять» конкретными именами листов/файлов. Статус — по факту (сделано / не сделано). Так ты явно связываешь схему с «что проверить в таблицах».

---

## 3. Существующие таблицы (кратко) и блоки схемы

Чтобы не теряться: какие листы/файлы уже есть и к каким блокам схемы они относятся.

| Что есть сейчас | К какому блоку схемы относится | Комментарий |
|-----------------|--------------------------------|-------------|
| **Бот (FinanceBot), Google Sheets** | | |
| Лист «Пользователи» | Блок 2 (юрлица), Блок 8 (исполнители) | Роли есть; привязка пользователя к юрлицу/магазину — нет или частично |
| Листы «Основные», «Разные выплаты», «USDT», «USDT Зарплаты», «CNY» | Блоки 3–5, 6–8 (операции с р/с, карт, USDT, получатели) | Заявки и выплаты; нет колонки «Юрлицо/Магазин» |
| «Фактические расходы», «Расчетный баланс», «Баланс счетов» | Блок 3 (р/с), сверки | По одному магазину/файлу |
| **Файлы из full_project_context** | | |
| Журнал операций МН (xlsx) | Блок 3–4 (банки, карты) | Горизонтальная структура; нет привязки к юрлицу в явном виде |
| Крипто-журнал (xlsx) | Блок 6 (USDT-кошельки) | Общий; без привязки к магазинам |
| Баланс счетов Cozy Space | Блок 3 (остатки по р/с) | По одному магазину |
| **Спроектировано (full_project_context), пока не везде внедрено** | | |
| Файл «Магазин [Название]» с листами: Маркетплейс, Бизнес-банк, Наличные, Физ.банки, Зарплаты, Себестоимость, Налоги, Сверка | Блоки 1–5, 8 | Целевая структура; пока не развёрнута для всех |

Итог: схема описывает **целевую** картину потоков; текущие таблицы покрывают её частично и без единого ключа «юрлицо/магазин». Следующий шаг — ввести этот ключ и один справочник.

---

## 4. План на первый шаг (~1 час и сразу после)

Цель: за минимальное время «зацепить» схему за реальные таблицы и задать структуру работы.

### Шаг 1 (15–20 мин): Справочник «Юрлицо»

- Создать один лист **«Юрлица»** (или таблицу в существующей книге) с колонками: **Код** (DBZ, MN, VAS, LYA, MAKS, LIFE, ALEX, HUB), **Название/контекст** (по желанию), **Расчётный счёт** (номер или «название счёта»), **WB** (да/нет), **Озон** (да/нет).
- Заполнить по текущему распределению (из СХЕМА_ПОТОКОВ_ОПИСАНИЕ или из головы).
- **Результат:** один источник истины «кто есть и какой р/с и какие площадки». Все дальнейшие листы могут ссылаться на «Код юрлица».

### Шаг 2 (15–20 мин): Привязка листов бота к юрлицу

- В листах заявок (Основные, Разные выплаты, USDT и т.д.) добавить колонку **«Юрлицо»** (или «Магазин») с допустимыми значениями: DBZ, MN, … (можно выпадающий список из листа «Юрлица»).
- Для старых строк: заполнить по возможности вручную или оставить «не задано» и заполнять по мере разбора.
- **Результат:** каждая новая заявка/операция привязана к юрлицу; можно фильтровать и сверять по схеме.

### Шаг 3 (10–15 мин): Одна точка сверки «Маркетплейс ↔ Р/с»

- Выбрать **одно** юрлицо и **один** месяц.
- Взять из финотчёта WB или Озон сумму «К перечислению на р/с» и сравнить с фактическим поступлением на р/с (выписка или журнал).
- Зафиксировать в любом виде (отдельный лист «Сверка МП–Р/с» или таблица): дата/период, юрлицо, площадка, сумма по финотчёту, сумма по банку, расхождение.
- **Результат:** первый работающий пример сверки по схеме (блок 1 → блок 3); шаблон для остальных магазинов.

### Шаг 4 (по желанию, 10 мин): Обновить «Пользователи» бота

- В листе «Пользователи» добавить колонку **«Юрлицо»** (или «Магазин»): кому к какому юрлицу относятся операции (менеджеры — свой магазин, собственник — все). Заполнить для тех, кого знаешь.
- **Результат:** бот и схема говорят на одном языке (юрлица из справочника).

### Шаг 5 (на потом): Правила из раздела 2

- Раз в неделю или после накопления данных проходить по чек-листу «Связи = правила» и отмечать, что уже выполняется, а где дырки. Дорабатывать листы и процессы по мере необходимости.

---

## 5. Как пользоваться схемой ежедневно

- **Новая операция / заявка:** определяй, между какими узлами схемы идёт поток (например: р/с DBZ → карты физлица DBZ). В таблице должна быть возможность указать «Юрлицо» и при необходимости «Счёт-источник / счёт-получатель».
- **Сверка:** используй 5 точек сверки из full_project_context; первая — «Маркетплейс ↔ Р/с» — напрямую из блоков 1 и 3 схемы.
- **Сомнения в правильности:** смотри связь на схеме (откуда → куда). Если в таблицах нет поля «юрлицо» или «направление» — добавь и заполни; так схема задаёт структуру работы.

---

После заполнения шагов 1–3 у тебя будет: (1) справочник юрлиц, (2) привязка операций к юрлицу, (3) один пример сверки МП↔р/с. Этого достаточно, чтобы «разобрать» схему и использовать её для проверки правильности и дальнейшего построения структуры работы с учётом существующих таблиц.
