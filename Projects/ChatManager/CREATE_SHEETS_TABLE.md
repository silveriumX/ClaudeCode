# Создание Google Sheets таблицы ChatManager

Service Account: `cursor@neat-geode-329707.iam.gserviceaccount.com`
Папка: `1H2rIofCknpGXHo-px0zw-PJsdhPvnUdv`

## Вариант 1: Через браузер (быстро, 5 минут)

### Шаг 1: Открыть папку

Открой в браузере:
```
https://drive.google.com/drive/folders/1H2rIofCknpGXHo-px0zw-PJsdhPvnUdv
```

### Шаг 2: Создать таблицу в этой папке

1. В открытой папке нажми: **+ New** → **Google Sheets** → **Blank spreadsheet**
2. Назови таблицу: **ChatManager Database**
3. Таблица автоматически сохранится в эту папку с правами для service account

### Шаг 3: Создать структуру

Создай 3 листа (переименуй "Sheet1" и добавь ещё 2):

#### Лист 1: "Пользователи"

Первая строка (заголовки):
```
telegram_id | имя | username | роль | статус
```

Пример данных (вторая строка - добавь себя):
```
твой_id | Твоё Имя | твой_username | admin | active
```

Как узнать свой ID: написать @userinfobot в Telegram

#### Лист 2: "Чаты"

Первая строка (заголовки):
```
id | название | creator_id | дата_создания | статус | invite_link | chat_id | описание
```

Оставь лист пустым (кроме заголовков) - бот будет заполнять автоматически.

#### Лист 3: "Участники"

Первая строка (заголовки):
```
chat_id | user_id | роль_в_чате | дата_добавления
```

Оставь лист пустым (кроме заголовков) - бот будет заполнять автоматически.

### Шаг 4: Скопировать ID таблицы

1. Открой созданную таблицу
2. Посмотри на URL:
   ```
   https://docs.google.com/spreadsheets/d/1a2b3c4d5e6f7g8h9i0j/edit
                                        ↑
                                   ВОТ ЭТОТ ID
   ```
3. Скопируй ID (часть между `/d/` и `/edit`)

### Шаг 5: Обновить .env

Открой файл `.env` в папке `Projects/ChatManager` и замени:
```env
GOOGLE_SHEETS_ID=твой_скопированный_id_сюда
```

### Шаг 6: Проверить

```bash
cd Projects/ChatManager
python test_system.py
```

Должно быть:
```
[OK] GOOGLE_SHEETS_ID is set
[OK] Google Sheets connection established
[OK] Users sheet: Пользователи
[OK] Chats sheet: Чаты
[OK] Participants sheet: Участники
=== ALL TESTS PASSED ===
```

---

## Вариант 2: Через Google Sheets напрямую (альтернатива)

1. Открой https://sheets.google.com
2. Создай таблицу: **+ Blank**
3. Назови: **ChatManager Database**
4. Создай структуру листов (как в Варианте 1, Шаг 3)
5. Перемести таблицу в папку:
   - Нажми на значок папки рядом с названием таблицы
   - Выбери: **Move to** → найди папку с ID `1H2rIofCknpGXHo-px0zw-PJsdhPvnUdv`
   - Нажми **Move**
6. Скопируй ID таблицы и обнови `.env` (как в Варианте 1, Шаги 4-5)

---

## Структура листов с примерами

### Лист "Пользователи" (4 колонки A-E)

| A (telegram_id) | B (имя) | C (username) | D (роль) | E (статус) |
|-----------------|---------|--------------|----------|------------|
| 123456789 | Иван Иванов | ivan_user | admin | active |
| 987654321 | Мария Петрова | maria_p | manager | active |

**Роли:**
- `admin` - может создавать неограниченное число чатов
- `manager` - может создавать чаты для команды
- `member` - только участие в чатах

**Статусы:**
- `active` - доступ разрешён
- `blocked` - доступ заблокирован

### Лист "Чаты" (8 колонок A-H)

| A (id) | B (название) | C (creator_id) | D (дата) | E (статус) | F (invite_link) | G (chat_id) | H (описание) |
|--------|--------------|----------------|----------|------------|-----------------|-------------|--------------|
| REQ-20260208-120000-a3c | Закупки январь | 123456789 | 08.02.2026 12:00:00 | created | https://t.me/+xyz | -1001234567 | Обсуждение закупок |

**Статусы чатов:**
- `pending` - ожидает создания
- `creating` - в процессе создания
- `created` - создан успешно (есть invite_link)
- `failed` - ошибка создания
- `archived` - архивирован

Этот лист заполняется автоматически ботом.

### Лист "Участники" (4 колонки A-D)

| A (chat_id) | B (user_id) | C (роль_в_чате) | D (дата_добавления) |
|-------------|-------------|-----------------|---------------------|
| -1001234567 | 123456789 | creator | 08.02.2026 12:00:05 |
| -1001234567 | 987654321 | member | 08.02.2026 12:01:00 |

**Роли в чате:**
- `creator` - создатель чата
- `admin` - администратор чата
- `member` - участник

Этот лист заполняется автоматически ботом.

---

## Следующие шаги после создания таблицы

1. ✅ Таблица создана и структура настроена
2. ✅ ID таблицы добавлен в `.env`
3. ✅ Проверка: `python test_system.py` → ALL TESTS PASSED

**Дальше:**

4. ⬜ Получить UserBot credentials (https://my.telegram.org/apps)
5. ⬜ Авторизовать UserBot: `python setup_userbot.py`
6. ⬜ Деплой на VPS: `python deploy_to_vps.py`

---

**Важно:**
- Service account `cursor@neat-geode-329707.iam.gserviceaccount.com` уже имеет доступ к папке
- Таблица в этой папке автоматически будет доступна для бота
- Не нужно дополнительно давать права - они уже есть через папку

**Время:** 5 минут
**Папка:** https://drive.google.com/drive/folders/1H2rIofCknpGXHo-px0zw-PJsdhPvnUdv
