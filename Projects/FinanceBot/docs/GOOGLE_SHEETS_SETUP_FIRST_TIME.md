# Подключение к Google Таблицам с нуля

Пошаговая инструкция для человека, который **никогда не заходил в Google Cloud**. Каждый шаг — куда нажать, что ввести. Следуйте по порядку.

---

## Что вы получите в итоге

- Файл `service_account.json` — ключ доступа к Google Sheets API.
- Возможность читать и записывать данные в Google Таблицу по её ID из вашего кода или приложения.

**Время:** около 15–20 минут при первом запуске.

---

## Часть 1. Google Cloud Console — проект и API

### Шаг 1.1. Открыть Google Cloud Console

1. Откройте в браузере: **https://console.cloud.google.com/**
2. Войдите в тот Google-аккаунт, с которым будете работать с таблицами.

---

### Шаг 1.2. Создать проект

1. Вверху страницы найдите выпадающий список с названием проекта (рядом с логотипом "Google Cloud").
2. Нажмите на него.
3. В открывшемся окне нажмите **"New Project"** / **"Создать проект"**.
4. В поле **"Project name"** введите любое название (например: `Мой проект`).
5. Нажмите **"Create"** / **"Создать"**.
6. Дождитесь создания проекта (несколько секунд).
7. Убедитесь, что вверху страницы выбран **именно этот новый проект**.

> Важно: все следующие шаги (API, Service Account, ключ) делаются **в одном и том же проекте**. Если создать другой проект по ошибке — API и ключ окажутся в нём, и доступ к таблице работать не будет.

---

### Шаг 1.3. Включить Google Sheets API

1. В **левом меню** нажмите **"APIs & Services"** (или **"Интерфейсы и сервисы"**).
2. В подменю выберите **"Library"** (**"Библиотека"**).
3. В поисковой строке вверху введите: **Google Sheets API**.
4. В результатах нажмите на карточку **"Google Sheets API"**.
5. На странице API нажмите синюю кнопку **"Enable"** (**"Включить"**).
6. Дождитесь включения (появится надпись, что API включён).

---

### Шаг 1.4. (Опционально) Включить Google Drive API

Нужно только если потребуется работа с файлами в Google Drive (загрузка, папки). Можно пропустить и включить позже.

1. Снова: левое меню → **"APIs & Services"** → **"Library"**.
2. В поиске введите: **Google Drive API**.
3. Откройте **"Google Drive API"** → нажмите **"Enable"** (**"Включить"**).

---

## Часть 2. Service Account и JSON-ключ

### Шаг 2.1. Открыть раздел учётных данных

1. В левом меню: **"APIs & Services"** → **"Credentials"** (**"Учётные данные"**).
2. Убедитесь, что вверху выбран нужный проект.

---

### Шаг 2.2. Создать Service Account

1. Вверху страницы нажмите **"+ Create Credentials"** (**"+ Создать учётные данные"**).
2. В выпадающем списке выберите **"Service account"** (**"Учётная запись службы"**).
3. Заполните:
   - **Service account name:** например `sheets-service`.
   - **Service account ID** подставится сам — не меняйте.
   - **Description** (необязательно): например `Доступ к Google Таблицам`.
4. Нажмите **"Create and Continue"** / **"Создать и продолжить"**.
5. На шаге "Grant access" (роль) можно выбрать **"Editor"** или оставить пустым — нажмите **"Continue"**.
6. На шаге "Grant users access" просто нажмите **"Done"** (**"Готово"**).

---

### Шаг 2.3. Создать и скачать JSON-ключ

1. На странице **Credentials** в блоке **"Service Accounts"** найдите только что созданную учётную запись.
2. Нажмите на **её email** (строка с адресом вида `...@....iam.gserviceaccount.com`).
3. Откроется страница Service Account. Перейдите на вкладку **"Keys"** (**"Ключи"**).
4. Нажмите **"Add Key"** (**"Добавить ключ"**) → **"Create new key"** (**"Создать новый ключ"**).
5. Выберите тип **JSON**.
6. Нажмите **"Create"** (**"Создать"**). Файл автоматически скачается (имя вида `проект-xxxxx-xxxxxxxxxxxx.json`).
7. **Переименуйте** этот файл в **`service_account.json`**.
8. **Сохраните** его в папку, откуда будет обращаться ваше приложение (или в любое безопасное место; путь к файлу потом укажете в настройках).

> Не публикуйте этот файл в интернете и не добавляйте в публичный репозиторий. Он даёт доступ к API от имени этого сервисного аккаунта.

---

### Шаг 2.4. Скопировать email Service Account

1. Откройте файл `service_account.json` в любом текстовом редакторе.
2. Найдите поле **`"client_email"`**. Значение — длинный email вида:
   `sheets-service@ваш-проект.iam.gserviceaccount.com`
3. **Скопируйте этот email целиком** — он понадобится для доступа к таблице.

---

## Часть 3. Google Таблица — доступ и ID

### Шаг 3.1. Дать доступ к таблице для Service Account

1. Откройте вашу Google Таблицу (или создайте новую) в браузере.
2. Нажмите кнопку **"Поделиться"** (**"Share"**) в правом верхнем углу.
3. В поле "Добавить пользователей" **вставьте скопированный email** Service Account (из шага 2.4).
4. Роль выберите **"Редактор"** (**"Editor"**).
5. Снимите галочку "Уведомить" (необязательно).
6. Нажмите **"Поделиться"** / **"Отправить"** или **"Готово"**.

Без этого шага доступ к таблице по API работать не будет.

---

### Шаг 3.2. Узнать ID таблицы

1. Таблица должна быть открыта в браузере.
2. Посмотрите адресную строку. URL имеет вид:
   ```
   https://docs.google.com/spreadsheets/d/1a2B3c4D5e6F7g8H9i0J_xxxxxxxxxx/edit
   ```
3. **ID таблицы** — это часть между `/d/` и `/edit`:
   ```
   1a2B3c4D5e6F7g8H9i0J_xxxxxxxxxx
   ```
4. Скопируйте этот ID — он понадобится в коде или конфиге (часто как `SPREADSHEET_ID` или `GOOGLE_SHEETS_ID`).

---

## Часть 4. Использование в приложении

### Где хранить ключ и ID

- **`service_account.json`** — положите в папку проекта или укажите полный путь в настройках. Не коммитьте файл в публичный репозиторий.
- **ID таблицы** — передавайте в код через переменную окружения или конфиг (например: `SPREADSHEET_ID`, `GOOGLE_SHEETS_ID`).

### Пример переменных окружения (.env)

```env
SPREADSHEET_ID=1a2B3c4D5e6F7g8H9i0J_xxxxxxxxxx
GOOGLE_APPLICATION_CREDENTIALS=service_account.json
```

Или путь к ключу задаётся в коде при инициализации клиента Sheets.

### Проверка подключения (Python, gspread)

Если используете Python и библиотеку `gspread` с Service Account:

```bash
python -c "
import gspread
from google.oauth2.service_account import Credentials
scope = ['https://www.googleapis.com/auth/spreadsheets']
creds = Credentials.from_service_account_file('service_account.json', scopes=scope)
gc = gspread.authorize(creds)
sh = gc.open_by_key('ВАШ_ID_ТАБЛИЦЫ')
print('OK', sh.title)
"
```

Подставьте вместо `ВАШ_ID_ТАБЛИЦЫ` скопированный ID. Если выведется **`OK`** и название листа — подключение работает.

При ошибке **403** или "permission denied":
- Убедитесь, что в "Поделиться" добавлен **именно** email из `service_account.json` (поле `client_email`) с ролью **Редактор**.

---

## Краткий чеклист

- [ ] Проект создан в Google Cloud.
- [ ] Включён **Google Sheets API** (и при необходимости **Google Drive API**).
- [ ] Создан **Service Account**, скачан и переименован ключ в `service_account.json`.
- [ ] Email из `client_email` добавлен в таблицу с ролью **Редактор**.
- [ ] ID таблицы скопирован (часть URL между `/d/` и `/edit`).
- [ ] Ключ и ID передаются в приложение (конфиг или переменные окружения).

---

## Частые ошибки

| Ошибка | Что проверить |
|--------|----------------|
| 403 / permission denied | Добавлен ли email из `service_account.json` (поле `client_email`) в "Поделиться" таблицы с ролью Редактор? |
| Drive API 403 / accessNotConfigured | Google Drive API включён в **том же проекте**, где создан Service Account (APIs & Services → Library → Google Drive API → Enable). |
| FileNotFoundError: service_account.json | Файл лежит в той же папке, откуда запускается приложение, или в конфиге указан верный путь к файлу. |
| Неверный ID таблицы | ID — это часть URL между `/d/` и `/edit`, без лишних символов. |

---

**Версия:** 1.1
**Дата:** 07.02.2026
