# –ü–ª–∞–Ω —É–ª—É—á—à–µ–Ω–∏–π: –ü—Ä–æ—Å—Ç—ã–µ –∏—Ç–µ—Ä–∞—Ü–∏–∏

## üéØ –ò–¢–ï–†–ê–¶–ò–Ø 1: SSH + –ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º (–°–ï–ì–û–î–ù–Ø, 1 —á–∞—Å)

### –ß—Ç–æ –¥–µ–ª–∞–µ–º:
1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å SSH –Ω–∞ 6 —Å–µ—Ä–≤–µ—Ä–æ–≤ (–≤—ã –≤—Ä—É—á–Ω—É—é, 20 –º–∏–Ω)
2. –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º –≤ SSH –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (—è, 10 –º–∏–Ω)
3. –ó–∞–¥–µ–ø–ª–æ–∏—Ç—å (—è, 5 –º–∏–Ω)
4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å (5 –º–∏–Ω)

### –†–µ–∑—É–ª—å—Ç–∞—Ç:
- ‚úÖ –°—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ (SSH –Ω–µ –ª–æ–º–∞–µ—Ç—Å—è)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ 17 —Å–µ—Ä–≤–µ—Ä–æ–≤ –∑–∞ 20 —Å–µ–∫—É–Ω–¥ (–≤–º–µ—Å—Ç–æ 3 –º–∏–Ω—É—Ç)
- ‚úÖ –ú–µ–Ω—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ VPS

### –ö–æ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏–π:
```python
# server_monitor_ssh.py - –¥–æ–±–∞–≤–∏—Ç—å 3 —Å—Ç—Ä–æ–∫–∏:

from concurrent.futures import ThreadPoolExecutor

def check_all_servers():
    servers = get_servers_from_sheets()

    # –°–¢–ê–†–´–ô –ö–û–î (–º–µ–¥–ª–µ–Ω–Ω–æ):
    # for server in servers:
    #     result = checker.check_full_status(...)

    # –ù–û–í–´–ô –ö–û–î (–±—ã—Å—Ç—Ä–æ):
    with ThreadPoolExecutor(max_workers=10) as executor:
        futures = {
            executor.submit(check_one_server, s): s
            for s in servers
        }

        for future in futures:
            result = future.result()
            # –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞...
```

**–°–ª–æ–∂–Ω–æ—Å—Ç—å: üü¢ –ü—Ä–æ—Å—Ç–∞—è**
**–†–∏—Å–∫: üü¢ –ù–∏–∑–∫–∏–π** (–ª–µ–≥–∫–æ –æ—Ç–∫–∞—Ç–∏—Ç—å)
**–≠—Ñ—Ñ–µ–∫—Ç: üî¥ –û–≥—Ä–æ–º–Ω—ã–π** (12x –±—ã—Å—Ç—Ä–µ–µ)

---

## üéØ –ò–¢–ï–†–ê–¶–ò–Ø 2: Retry + Timeout (–ó–ê–í–¢–†–ê, 30 –º–∏–Ω)

### –ß—Ç–æ –¥–µ–ª–∞–µ–º:
```python
# ssh_connector.py - –∏–∑–º–µ–Ω–∏—Ç—å execute_command:

def execute_command(self, ip, username, password, ps_command):
    for attempt in range(3):  # ‚Üê –î–æ–±–∞–≤–∏—Ç—å retry
        try:
            client = paramiko.SSHClient()
            # ... –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ ...
            return output
        except Exception as e:
            if attempt < 2:  # –ù–µ –ø–æ—Å–ª–µ–¥–Ω—è—è –ø–æ–ø—ã—Ç–∫–∞
                time.sleep(2)  # –ü–∞—É–∑–∞
                continue
            else:
                raise  # –ü–æ—Å–ª–µ 3 –ø–æ–ø—ã—Ç–æ–∫ - –æ—à–∏–±–∫–∞
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç:
- ‚úÖ –ú–µ–Ω—å—à–µ false-positive –æ—à–∏–±–æ–∫
- ‚úÖ –£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ –≤—Ä–µ–º–µ–Ω–Ω—ã–º —Å–±–æ—è–º —Å–µ—Ç–∏

**–°–ª–æ–∂–Ω–æ—Å—Ç—å: üü¢ –ü—Ä–æ—Å—Ç–∞—è**
**–†–∏—Å–∫: üü¢ –ù–∏–∑–∫–∏–π**
**–≠—Ñ—Ñ–µ–∫—Ç: üü° –°—Ä–µ–¥–Ω–∏–π**

---

## üéØ –ò–¢–ï–†–ê–¶–ò–Ø 3: –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ (–ß–ï–†–ï–ó –ù–ï–î–ï–õ–Æ, 20 –º–∏–Ω)

### –ü—Ä–æ–±–ª–µ–º–∞:
Google Sheets API —É–ø–∞–ª ‚Üí –Ω–µ –º–æ–∂–µ–º –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Å–µ—Ä–≤–µ—Ä–æ–≤ ‚Üí –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω

### –†–µ—à–µ–Ω–∏–µ:
```python
def get_servers_from_sheets():
    try:
        response = requests.get(...)
        servers = parse(response)

        # –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—É—é –∫–æ–ø–∏—é
        with open('/opt/server-monitor/.servers_cache.json', 'w') as f:
            json.dump(servers, f)

        return servers
    except:
        # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫—ç—à
        with open('/opt/server-monitor/.servers_cache.json') as f:
            return json.load(f)
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç:
- ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –µ—Å–ª–∏ Google Sheets –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω

**–°–ª–æ–∂–Ω–æ—Å—Ç—å: üü¢ –ü—Ä–æ—Å—Ç–∞—è**
**–†–∏—Å–∫: üü¢ –ù–∏–∑–∫–∏–π**
**–≠—Ñ—Ñ–µ–∫—Ç: üü° –°—Ä–µ–¥–Ω–∏–π**

---

## üéØ –ò–¢–ï–†–ê–¶–ò–Ø 4: –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (–ö–û–ì–î–ê –ï–°–¢–¨ –í–†–ï–ú–Ø, 2 —á–∞—Å–∞)

### –í–∞—Ä–∏–∞–Ω—Ç A: –ü—Ä–æ—Å—Ç–æ–π (Windows DPAPI)
```python
import win32crypt  # –ù–∞ Windows

# –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª—è:
encrypted = win32crypt.CryptProtectData(password.encode())

# –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞:
password = win32crypt.CryptUnprotectData(encrypted).decode()
```

### –í–∞—Ä–∏–∞–Ω—Ç B: –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π (Ansible Vault)
```bash
# –°–æ–∑–¥–∞—Ç—å –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–∞–π–ª:
ansible-vault create servers_encrypted.yml

# –í Python:
from ansible.parsing.vault import VaultLib
vault = VaultLib(password='secret')
data = vault.decrypt(encrypted_file)
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç:
- ‚úÖ –ü–∞—Ä–æ–ª–∏ –Ω–µ –≤ plaintext
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ

**–°–ª–æ–∂–Ω–æ—Å—Ç—å: üü° –°—Ä–µ–¥–Ω—è—è**
**–†–∏—Å–∫: üü° –°—Ä–µ–¥–Ω–∏–π**
**–≠—Ñ—Ñ–µ–∫—Ç: üü° –°—Ä–µ–¥–Ω–∏–π** (–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, –Ω–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å)

---

## üéØ –ò–¢–ï–†–ê–¶–ò–Ø 5: Cleanup (–ü–û–°–õ–ï–î–ù–ï–ï)

### –ß—Ç–æ —É–¥–∞–ª–∏—Ç—å:
```bash
# –¢–µ—Å—Ç–æ–≤—ã–µ —Å–∫—Ä–∏–ø—Ç—ã (–º–æ–∂–Ω–æ –≤—Å–µ —É–¥–∞–ª–∏—Ç—å):
rm test_*.py       # 20 —Ñ–∞–π–ª–æ–≤
rm check_*.py      # 15 —Ñ–∞–π–ª–æ–≤
rm debug_*.py      # 10 —Ñ–∞–π–ª–æ–≤
rm diagnose_*.py   # 5 —Ñ–∞–π–ª–æ–≤
rm analyze_*.py    # 3 —Ñ–∞–π–ª–∞

# –û—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ:
- deploy_ssh_monitoring.py
- server-monitor-package/
- SSH_MONITORING_README.md
- ACTION_PLAN_SIMPLE.md
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç:
- ‚úÖ –ß–∏—Å—Ç–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
- ‚úÖ –õ–µ–≥–∫–æ –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è

**–°–ª–æ–∂–Ω–æ—Å—Ç—å: üü¢ –¢—Ä–∏–≤–∏–∞–ª—å–Ω–∞—è**
**–†–∏—Å–∫: üü¢ –ù—É–ª–µ–≤–æ–π**
**–≠—Ñ—Ñ–µ–∫—Ç: üü¢ –£–ª—É—á—à–µ–Ω–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∏**

---

## üìä –ú–ï–¢–†–ò–ö–ò –£–°–ü–ï–•–ê

| –ú–µ—Ç—Ä–∏–∫–∞ | –°–µ–π—á–∞—Å | –ü–æ—Å–ª–µ –ò—Ç–µ—Ä–∞—Ü–∏–∏ 1 | –ü–æ—Å–ª–µ –ò—Ç–µ—Ä–∞—Ü–∏–∏ 2 |
|---------|--------|------------------|------------------|
| –í—Ä–µ–º—è –ø—Ä–æ–≤–µ—Ä–∫–∏ | 180 —Å–µ–∫ | 20 —Å–µ–∫ | 15 —Å–µ–∫ |
| WinRM –æ—à–∏–±–∫–∏ | 6/17 | 0/17 | 0/17 |
| False positives | –ß–∞—Å—Ç–æ | –†–µ–¥–∫–æ | –û—á–µ–Ω—å —Ä–µ–¥–∫–æ |
| –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å | 60% | 95% | 99% |

---

## ‚úÖ –§–ò–ù–ê–õ–¨–ù–ê–Ø –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–Ø

**–î–ï–õ–ê–ô–¢–ï –ò–¢–ï–†–ê–¶–ò–ò 1-2 –°–ï–ô–ß–ê–°:**

1. **–°–µ–≥–æ–¥–Ω—è (1 —á–∞—Å):**
   - –í—ã: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ SSH –Ω–∞ 6 —Å–µ—Ä–≤–µ—Ä–æ–≤
   - –Ø: –î–æ–±–∞–≤–ª—é –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º + –∑–∞–¥–µ–ø–ª–æ—é
   - –†–µ–∑—É–ª—å—Ç–∞—Ç: –ë—ã—Å—Ç—Ä–∞—è –∏ —Å—Ç–∞–±–∏–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞

2. **–ó–∞–≤—Ç—Ä–∞ (30 –º–∏–Ω):**
   - –Ø: –î–æ–±–∞–≤–ª—é retry –ª–æ–≥–∏–∫—É
   - –†–µ–∑—É–ª—å—Ç–∞—Ç: –ï—â—ë —Å—Ç–∞–±–∏–ª—å–Ω–µ–µ

3. **–û—Å—Ç–∞–ª—å–Ω–æ–µ - –ø–æ –∂–µ–ª–∞–Ω–∏—é, –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ**

---

**–ù–∞—á–∏–Ω–∞–µ–º —Å –ò—Ç–µ—Ä–∞—Ü–∏–∏ 1?** –Ø —É–∂–µ –≥–æ—Ç–æ–≤ –¥–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º –≤ SSH –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥.
