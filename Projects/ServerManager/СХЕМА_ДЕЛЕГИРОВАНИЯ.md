# 🎨 Визуальная схема делегирования серверов

> Наглядные диаграммы для понимания системы

---

## 📊 Общая архитектура

```
╔══════════════════════════════════════════════════════════════════════════╗
║                           ТВОЯ ГЛАВНАЯ ТАБЛИЦА                           ║
║                         (Полный доступ, все данные)                      ║
╠══════════════════════════════════════════════════════════════════════════╣
║  Магазин │ RDP │ Хостер │ Прокси │ Почты │ Выдать │ Статус │ IP │ ...  ║
╠──────────┼─────┼────────┼────────┼───────┼────────┼────────┼────┼───────╣
║  Shop_01 │ ... │ Host_A │ Proxy1 │ mail1 │   Да   │ Online │... │ ...  ║
║  Shop_02 │ ... │ Host_B │ Proxy2 │ mail2 │Сисадмин│ Online │... │ ...  ║
║  Shop_03 │ ... │ Host_C │ Proxy3 │ mail3 │   Да   │ Online │... │ ...  ║
║  Shop_04 │ ... │ Host_A │ Proxy1 │ mail4 │Сисадмин│ Online │... │ ...  ║
║  Shop_05 │ ... │ Host_B │ Proxy4 │ mail5 │Сисадмин│ ERROR  │... │ ...  ║
╚══════════════════════════════════════════════════════════════════════════╝
                                    │
                                    │ Лист "Для_Сисадмина"
                                    │ =QUERY(...WHERE Выдать='Сисадмин')
                                    │ (фильтрует только нужные строки
                                    │  и только безопасные колонки)
                                    ▼
┌──────────────────────────────────────────────────────────────────────────┐
│                    Лист "Для_Сисадмина" (внутри)                         │
├──────────────────────────────────────────────────────────────────────────┤
│  Магазин │  RDP  │ AnyDesk │ Статус │ IP  │ Город │ Команда │ Результат │
├──────────┼───────┼─────────┼────────┼─────┼───────┼─────────┼───────────┤
│  Shop_02 │  ...  │  12345  │ Online │ ... │  MSK  │         │   ✅ OK   │
│  Shop_04 │  ...  │  67890  │ Online │ ... │  SPB  │  check  │ Checking..│
│  Shop_05 │  ...  │  11111  │ ERROR  │ N/A │  N/A  │         │  ❌ Down  │
└──────────────────────────────────────────────────────────────────────────┘
                                    │
                                    │ IMPORTRANGE
                                    │ (автоматическая синхронизация)
                                    │
                                    ▼
╔══════════════════════════════════════════════════════════════════════════╗
║                        ТАБЛИЦА ДЛЯ СИСАДМИНА                             ║
║                   (Доступ: Editor, только выбранные)                     ║
╠══════════════════════════════════════════════════════════════════════════╣
║  Магазин │  RDP  │ AnyDesk │ Статус │ IP  │ Город │ Команда │ Результат ║
╠──────────┼───────┼─────────┼────────┼─────┼───────┼─────────┼───────────╣
║  Shop_02 │  ...  │  12345  │ Online │ ... │  MSK  │         │   ✅ OK   ║
║  Shop_04 │  ...  │  67890  │ Online │ ... │  SPB  │  check  │ Checking..║
║  Shop_05 │  ...  │  11111  │ ERROR  │ N/A │  N/A  │         │  ❌ Down  ║
╠══════════════════════════════════════════════════════════════════════════╣
║  + Google Apps Script (меню "Управление")                                ║
║    - Выполнить команды                                                   ║
║    - Проверить сервера                                                   ║
║    - Показать статистику                                                 ║
╚══════════════════════════════════════════════════════════════════════════╝
                                    │
                                    │ Webhook: http://VPS_IP:8080/execute_command
                                    │ POST {rdp: "...", command: "check"}
                                    │
                                    ▼
╔══════════════════════════════════════════════════════════════════════════╗
║                    LINUX VPS (Сервер управления)                         ║
╠══════════════════════════════════════════════════════════════════════════╣
║  • Получает команды через webhook                                        ║
║  • Выполняет через WinRM на Windows серверах                             ║
║  • Собирает статусы (IP, GEO, процессы)                                  ║
║  • Обновляет данные в Google Sheets                                      ║
╚══════════════════════════════════════════════════════════════════════════╝
                                    │
                                    │ WinRM (PowerShell remoting)
                                    │
                    ┌───────────────┼───────────────┐
                    ▼               ▼               ▼
            ┌──────────────┐┌──────────────┐┌──────────────┐
            │  Windows VPS ││  Windows VPS ││  Windows VPS │
            │   (Shop_02)  ││   (Shop_04)  ││   (Shop_05)  │
            │              ││              ││              │
            │  Proxifier ✅││  Proxifier ✅││  Proxifier ❌│
            │  AnyDesk  ✅││  AnyDesk  ✅││  AnyDesk  ❌│
            └──────────────┘└──────────────┘└──────────────┘
```

---

## 🔄 Процесс выполнения команды

```
┌─────────────────────────────────────────────────────────────────────────┐
│ 1. СИСАДМИН                                                             │
│    Вводит команду в таблицу: "restart_proxifier"                       │
│    Нажимает: Управление → Выполнить команды                            │
└────────────────────────────┬────────────────────────────────────────────┘
                             │
                             │ Google Apps Script
                             │ (обработка в таблице)
                             ▼
┌─────────────────────────────────────────────────────────────────────────┐
│ 2. GOOGLE APPS SCRIPT                                                   │
│    • Читает колонку "Команда"                                           │
│    • Находит команды для выполнения                                     │
│    • Формирует JSON: {rdp: "...", command: "restart_proxifier"}        │
│    • Отправляет POST запрос на webhook                                  │
│    • Очищает колонку "Команда"                                          │
└────────────────────────────┬────────────────────────────────────────────┘
                             │
                             │ HTTP POST
                             │ http://VPS_IP:8080/execute_command
                             ▼
┌─────────────────────────────────────────────────────────────────────────┐
│ 3. LINUX VPS (Command Handler)                                         │
│    • Получает команду через Flask webhook                              │
│    • Парсит RDP (IP:Username:Password)                                 │
│    • Определяет какую команду выполнить                                 │
│    • Подключается к Windows серверу через WinRM                        │
└────────────────────────────┬────────────────────────────────────────────┘
                             │
                             │ WinRM Connection
                             │ (PowerShell Remoting)
                             ▼
┌─────────────────────────────────────────────────────────────────────────┐
│ 4. WINDOWS VPS (целевой сервер)                                        │
│    • Получает PowerShell команду через WinRM                           │
│    • Выполняет: Stop-Process Proxifier                                 │
│    • Выполняет: Start-Process Proxifier                                │
│    • Возвращает результат выполнения                                   │
└────────────────────────────┬────────────────────────────────────────────┘
                             │
                             │ Результат выполнения
                             ▼
┌─────────────────────────────────────────────────────────────────────────┐
│ 5. LINUX VPS (обновление данных)                                       │
│    • Получает результат от Windows                                     │
│    • Формирует текст результата: "✅ Proxifier перезапущен"            │
│    • Отправляет POST в Google Sheets API                               │
│    • Обновляет колонку "Результат"                                     │
└────────────────────────────┬────────────────────────────────────────────┘
                             │
                             │ Google Sheets API
                             │ (обновление данных)
                             ▼
┌─────────────────────────────────────────────────────────────────────────┐
│ 6. GOOGLE SHEETS (обе таблицы)                                         │
│    • Главная таблица: обновлена колонка "Результат"                    │
│    • IMPORTRANGE синхронизирует данные                                 │
│    • Таблица сисадмина: появляется результат                           │
│    • Сисадмин видит: "✅ Proxifier перезапущен"                        │
└─────────────────────────────────────────────────────────────────────────┘

⏱️ Общее время: 10-30 секунд
```

---

## 🔐 Что видит сисадмин VS что скрыто

```
╔═══════════════════════════════════════════════════════════════════════╗
║                    ЧТО ВИДИТ СИСАДМИН (безопасно)                     ║
╠═══════════════════════════════════════════════════════════════════════╣
║  ✅ Магазин (Shop_02)                                                 ║
║  ✅ RDP доступ (123.45.67.89:admin:password)                          ║
║  ✅ AnyDesk ID (123456789)                                            ║
║  ✅ Статус машины (Online / ERROR)                                    ║
║  ✅ Статус прокси (OK / ERROR)                                        ║
║  ✅ Текущий IP (10.20.30.40)                                          ║
║  ✅ Текущий город (Moscow)                                            ║
║  ✅ Запущен ли AnyDesk (✅/❌)                                         ║
║  ✅ Запущен ли RustDesk (✅/❌)                                        ║
║  ✅ Дата последней проверки (24.01.26 10:30)                          ║
║  ✅ Колонка "Команда" (для ввода команд)                              ║
║  ✅ Результаты проверок и команд                                      ║
╚═══════════════════════════════════════════════════════════════════════╝

╔═══════════════════════════════════════════════════════════════════════╗
║                      ЧТО СКРЫТО (чувствительно)                       ║
╠═══════════════════════════════════════════════════════════════════════╣
║  ❌ Хостер (rdp.monster / vdsina.com)                                 ║
║  ❌ Логин хостера (user@example.com)                                  ║
║  ❌ Пароль хостера (SecretPassword123)                                ║
║  ❌ Прокси-провайдер (Proxyma / ProxyLine)                            ║
║  ❌ Логин прокси-провайдера (proxy_user)                              ║
║  ❌ Пароль прокси-провайдера (ProxyPass456)                           ║
║  ❌ Proxyma API Key (sk-abc123def456...)                              ║
║  ❌ Package Key прокси (pkg_xyz789...)                                ║
║  ❌ Прокси реквизиты (socks5://user:pass@host:port)                   ║
║  ❌ Почта 1 (shop02@gmail.com)                                        ║
║  ❌ Пароль почты 1 (EmailPass123)                                     ║
║  ❌ Почта 2 (shop02_backup@mail.ru)                                   ║
║  ❌ Пароль почты 2 (EmailPass456)                                     ║
║  ❌ Сумма оплаты прокси (500₽)                                        ║
║  ❌ Дата оплаты прокси (25.01.2026)                                   ║
║  ❌ Сумма оплаты сервера (800₽)                                       ║
║  ❌ Дата оплаты сервера (01.02.2026)                                  ║
║  ❌ Название профиля ADS Power (Hoster_A_Profile)                     ║
║  ❌ Баланс кабинета прокси-провайдера (1500₽)                         ║
║  ❌ Другие магазины (Shop_01, Shop_03, ...)                           ║
╚═══════════════════════════════════════════════════════════════════════╝
```

---

## 📈 Этапы расширения доступа

```
┌──────────────────────────────────────────────────────────────────────┐
│                         ЭТАП 1: ТЕСТИРОВАНИЕ                         │
│                            (Неделя 1)                                │
├──────────────────────────────────────────────────────────────────────┤
│  Серверов: 2-3 (некритичные, стабильные)                            │
│  Доступ: Ограниченный (только к тестовым)                           │
│  Задачи:                                                             │
│    • Изучить систему                                                 │
│    • Подключиться к серверам                                         │
│    • Протестировать команды                                          │
│    • Написать первый анализ                                          │
└──────────────────────────────────────────────────────────────────────┘
                                ▼
┌──────────────────────────────────────────────────────────────────────┐
│                     ЭТАП 2: РАСШИРЕНИЕ                               │
│                          (Неделя 2)                                  │
├──────────────────────────────────────────────────────────────────────┤
│  Серверов: 5-7 (добавить некритичные)                               │
│  Доступ: Расширенный                                                 │
│  Задачи:                                                             │
│    • Мониторинг большего количества серверов                         │
│    • Самостоятельное решение проблем                                 │
│    • Предложения по улучшению                                        │
│    • Работа с алертами                                               │
└──────────────────────────────────────────────────────────────────────┘
                                ▼
┌──────────────────────────────────────────────────────────────────────┐
│                       ЭТАП 3: АКТИВНАЯ РАБОТА                        │
│                            (Неделя 3-4)                              │
├──────────────────────────────────────────────────────────────────────┤
│  Серверов: 10-15                                                     │
│  Доступ: Полноценный (но не критичные)                               │
│  Задачи:                                                             │
│    • Полное обслуживание выданных серверов                           │
│    • Настройка новых серверов                                        │
│    • Реализация улучшений                                            │
│    • Документирование процессов                                      │
└──────────────────────────────────────────────────────────────────────┘
                                ▼
┌──────────────────────────────────────────────────────────────────────┐
│                    ЭТАП 4: ПОЛНАЯ САМОСТОЯТЕЛЬНОСТЬ                  │
│                            (Месяц 1+)                                │
├──────────────────────────────────────────────────────────────────────┤
│  Серверов: Все необходимые                                           │
│  Доступ: Полный к своей зоне ответственности                         │
│  Задачи:                                                             │
│    • Самостоятельное управление                                      │
│    • Проактивное улучшение системы                                   │
│    • Обучение новых администраторов                                  │
│    • Стратегическое планирование инфраструктуры                      │
└──────────────────────────────────────────────────────────────────────┘
```

---

## 🔄 Управление доступом (как это работает)

```
ГЛАВНАЯ ТАБЛИЦА - Колонка "Выдать"
┌──────────┬─────────┐
│ Магазин  │ Выдать  │ ◄── Ты управляешь этой колонкой
├──────────┼─────────┤
│ Shop_01  │   Да    │ ─────► НЕ появится в таблице сисадмина
│ Shop_02  │Сисадмин │ ─────► Появится ✅
│ Shop_03  │         │ ─────► НЕ появится
│ Shop_04  │Сисадмин │ ─────► Появится ✅
│ Shop_05  │Сисадмин │ ─────► Появится ✅
│ Shop_06  │   Да    │ ─────► НЕ появится
└──────────┴─────────┘
         │
         │ Формула QUERY фильтрует
         │ WHERE Выдать='Сисадмин'
         ▼
┌──────────┐
│ Shop_02  │ ─┐
│ Shop_04  │  │ IMPORTRANGE
│ Shop_05  │  │ синхронизирует →  ТАБЛИЦА СИСАДМИНА
└──────────┘ ─┘                  (видит только эти 3)


КАК ДОБАВИТЬ СЕРВЕР:
┌──────────┬─────────┐
│ Shop_06  │   Да    │  ─┐
└──────────┴─────────┘   │ Измени на "Сисадмин"
          ▼               │
┌──────────┬─────────┐   │
│ Shop_06  │Сисадмин │ ◄─┘
└──────────┴─────────┘
          │
          │ Автоматически через 5 сек
          ▼
   Появится в таблице сисадмина ✅


КАК УБРАТЬ СЕРВЕР:
┌──────────┬─────────┐
│ Shop_02  │Сисадмин │  ─┐
└──────────┴─────────┘   │ Измени на "Да" или пусто
          ▼               │
┌──────────┬─────────┐   │
│ Shop_02  │   Да    │ ◄─┘
└──────────┴─────────┘
          │
          │ Автоматически через 5 сек
          ▼
   Исчезнет из таблицы сисадмина ❌
```

---

## 📊 Статистика и мониторинг

```
ГЛАВНАЯ ТАБЛИЦА (у тебя)
╔═══════════════════════════════════════════════════════════╗
║  📊 Всего серверов: 29                                    ║
║  ✅ Онлайн: 25 (86%)                                      ║
║  ❌ Проблемы: 4 (14%)                                     ║
║  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  ║
║  👤 Выдано сисадмину: 3 (10%)                            ║
║  🔒 Оставлено у себя: 26 (90%)                           ║
╚═══════════════════════════════════════════════════════════╝

ТАБЛИЦА СИСАДМИНА (у него)
╔═══════════════════════════════════════════════════════════╗
║  📊 Всего серверов: 3                                     ║
║  ✅ Онлайн: 2 (67%)                                       ║
║  ❌ Проблемы: 1 (33%)                                     ║
║  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  ║
║  🟢 Shop_02: Online                                       ║
║  🟢 Shop_04: Online                                       ║
║  🔴 Shop_05: ERROR                                        ║
╚═══════════════════════════════════════════════════════════╝

Данные синхронизируются автоматически каждые 20 минут!
```

---

## 🎯 Timeline процесса делегирования

```
День 0 (сегодня)
├─ Настройка системы (30 минут)
│  ├─ Выбрать сервера
│  ├─ Создать формулу фильтрации
│  ├─ Создать таблицу для сисадмина
│  ├─ Настроить Apps Script
│  └─ Передать доступ
│
День 1
├─ Сисадмин изучает систему
│  ├─ Читает документацию
│  └─ Задаёт вопросы
│
День 2-3
├─ Сисадмин тестирует
│  ├─ Подключается к серверам
│  ├─ Выполняет команды
│  └─ Проверяет мониторинг
│
День 4-7
├─ Сисадмин пишет анализ
│  ├─ Изучает проблемы
│  ├─ Предлагает улучшения
│  └─ Отправляет анализ
│
День 7
├─ Обсуждение результатов
│  ├─ Call с сисадмином
│  ├─ Обсуждение предложений
│  └─ Решение о расширении
│
День 8-14
├─ Расширение доступа (если ОК)
│  ├─ Добавить 2-5 серверов
│  ├─ Более сложные задачи
│  └─ Проактивная работа
│
День 30+
└─ Полная самостоятельность
   ├─ Сисадмин управляет серверами
   ├─ Ты освободил время
   └─ Система работает стабильнее ✅
```

---

**Готово! 🎨**

Используй эти схемы для визуального понимания системы делегирования.
