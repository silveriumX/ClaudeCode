# PROJECT PLAN ‚Äî –§–∏–Ω–∞–Ω—Å–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞
**–û–±–Ω–æ–≤–ª–µ–Ω–æ:** 20.02.2026
**–¶–µ–ª—å:** –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π P&L –∏ –∫—ç—à—Ñ–ª–æ—É –ø–æ –≤—Å–µ–º —é—Ä–ª–∏—Ü–∞–º + –ª–∏—á–Ω—ã–µ —Ñ–∏–Ω–∞–Ω—Å—ã –≤–ª–∞–¥–µ–ª—å—Ü–∞

---

## –û–ë–©–ê–Ø –°–•–ï–ú–ê –¢–û–ì–û, –ß–¢–û –°–¢–†–û–ò–ú

```
–ò–°–¢–û–ß–ù–ò–ö–ò                   –û–ë–†–ê–ë–û–¢–ö–ê              –í–´–•–û–î
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ                   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ              ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Modulbank —Ä/—Å XLSX          parser.py           ‚îê
–¢–∏–Ω—å–∫–æ—Ñ—Ñ –∫–∞—Ä—Ç–∞ CSV/XLSX     tinkoff_parser.py   ‚îÇ
–°–±–µ—Ä–±–∞–Ω–∫ –∫–∞—Ä—Ç–∞              sber_parser.py      ‚îú‚îÄ merge_pnl.py ‚îÄ‚Üí Excel P&L
–ê–ª—å—Ñ–∞ / –í–¢–ë / –†–µ–Ω–µ—Å—Å–∞–Ω—Å     ...parsers...       ‚îÇ     (3 —É—Ä–æ–≤–Ω—è: —é—Ä–ª–∏—Ü–æ /
                                                ‚îÇ      –∫–ª–∞—Å—Ç–µ—Ä / –∫–æ–º–ø–∞–Ω–∏—è)
FinanceBot Sheets           fb_adapter.py       ‚îÇ
  (–û—Å–Ω–æ–≤–Ω—ã–µ/USDT/CNY/–§–∞–∫—Ç)                      ‚î§
                                                ‚îÇ
Bybit CSV                   bybit_adapter.py    ‚îÇ
–ù–∞–ª–∏—á–Ω—ã–µ                    manual_entry.py     ‚îÇ
WB/Ozon —Ñ–∏–Ω–æ—Ç—á—ë—Ç—ã           wb_parser.py        ‚îò
                                                ‚îÇ
clusters.json               entity_patterns     ‚Üí —Ä–∞–∑–º–µ—Ç–∫–∞ –ø–æ —é—Ä–ª–∏—Ü–∞–º
                            fx_rates            ‚Üí –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤–∞–ª—é—Ç

–ò–¢–û–ì: –ï–¥–∏–Ω—ã–π –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π –∂—É—Ä–Ω–∞–ª –≤ Google Sheets (–∑–∞–º–µ–Ω–∞ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ)
      + –î–∞—à–±–æ—Ä–¥ P&L / –ö—ç—à—Ñ–ª–æ—É
```

---

## –§–ê–ó–ê 1: MODULBANK –†/–° + FINANCEBOT ‚úÖ –ì–û–¢–û–í–û

| # | –ó–∞–¥–∞—á–∞ | –§–∞–π–ª | –°—Ç–∞—Ç—É—Å |
|---|--------|------|--------|
| 1.1 | –ü–∞—Ä—Å–µ—Ä Modulbank XLSX | `src/parser.py` | ‚úÖ |
| 1.2 | –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–∞–Ω–∫–æ–≤—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π | `src/classifier.py` | ‚úÖ |
| 1.3 | –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ —Ç–∏–ø–æ–≤/–∫–∞—Ç–µ–≥–æ—Ä–∏–π | `src/categories.py` | ‚úÖ |
| 1.4 | CLI: –≤—ã–ø–∏—Å–∫–∞ ‚Üí Excel –æ—Ç—á—ë—Ç | `import_statement.py` | ‚úÖ |
| 1.5 | CLI: —Å–≤–µ—Ä–∫–∞ —Å —Ä—É—á–Ω—ã–º –∂—É—Ä–Ω–∞–ª–æ–º | `diff_journal.py` | ‚úÖ |
| 1.6 | –ê–¥–∞–ø—Ç–µ—Ä FinanceBot Sheets | `src/fb_adapter.py` | ‚úÖ |
| 1.7 | –°–≤–æ–¥–Ω—ã–π P&L (–º—É–ª—å—Ç–∏-–±–∞–Ω–∫ + FB) | `merge_pnl.py` | ‚úÖ |
| 1.8 | –ö–æ–Ω—Ñ–∏–≥ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ –∏ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ | `clusters.json` | ‚úÖ |

**–†–µ–∑—É–ª—å—Ç–∞—Ç –§–∞–∑—ã 1 –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö DBZ:**
- 321 –æ–ø–µ—Ä–∞—Ü–∏—è Modulbank, 100% –∞–≤—Ç–æ-–∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è
- diff: 90% –ø–æ–∫—Ä—ã—Ç–∏–µ –∂—É—Ä–Ω–∞–ª–∞ (101/112)
- P&L: –±–∞–Ω–∫ + FinanceBot —Å —Ä–∞–∑–¥–µ–ª—å–Ω—ã–º USDT –±–ª–æ–∫–æ–º

---

## –§–ê–ó–ê 2: –ü–ê–†–°–ï–†–´ –õ–ò–ß–ù–´–• –ö–ê–†–¢ ‚è≥ –ñ–î–Å–ú –ü–†–ò–ú–ï–†–´ –§–ê–ô–õ–û–í

**–¶–µ–ª—å:** –ü–æ–ª–Ω—ã–π –∫—ç—à—Ñ–ª–æ—É —Ñ–∏–∑–ª–∏—Ü–∞ (personal finance) –¥–ª—è –æ–¥–Ω–æ–≥–æ —é—Ä–ª–∏—Ü–∞ (DBZ).

### 2.1 –ü–∞—Ä—Å–µ—Ä—ã –±–∞–Ω–∫–æ–≤ —Ñ–∏–∑–ª–∏—Ü–∞

–î–ª—è –∫–∞–∂–¥–æ–≥–æ –±–∞–Ω–∫–∞ ‚Äî —Å–≤–æ–π —Ñ–æ—Ä–º–∞—Ç –≤—ã–≥—Ä—É–∑–∫–∏. –ù—É–∂–Ω—ã –ø—Ä–∏–º–µ—Ä—ã —Ñ–∞–π–ª–æ–≤ (—Ä–µ–∞–ª—å–Ω—ã–µ –∏–ª–∏ —Å –∑–∞–º–∞–∑–∞–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏).

| –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –ë–∞–Ω–∫ | –û–∂–∏–¥–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç | –°—Ç–∞—Ç—É—Å |
|-----------|------|-----------------|--------|
| üî¥ 1 | –¢–∏–Ω—å–∫–æ—Ñ—Ñ | CSV (`;`), –∑–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–∞ 1-–π —Å—Ç—Ä–æ–∫–µ | ‚è≥ –Ω–µ—Ç –ø—Ä–∏–º–µ—Ä–∞ |
| üî¥ 2 | –ê–ª—å—Ñ–∞ | CSV, –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ —Ñ–æ—Ä–º–∞—Ç–æ–≤ | ‚è≥ –Ω–µ—Ç –ø—Ä–∏–º–µ—Ä–∞ |
| üî¥ 3 | –°–±–µ—Ä–±–∞–Ω–∫ | Excel XLSX | ‚è≥ –Ω–µ—Ç –ø—Ä–∏–º–µ—Ä–∞ |
| üü° 4 | –í–¢–ë | CSV –∏–ª–∏ Excel | ‚è≥ –Ω–µ—Ç –ø—Ä–∏–º–µ—Ä–∞ |
| üü° 5 | –†–µ–Ω–µ—Å—Å–∞–Ω—Å | Excel | ‚è≥ –Ω–µ—Ç –ø—Ä–∏–º–µ—Ä–∞ |
| üü¢ 6 | –ü–æ—á—Ç–∞ –ë–∞–Ω–∫ | Excel/CSV | ‚è≥ –Ω–µ—Ç –ø—Ä–∏–º–µ—Ä–∞ |
| üü¢ 7 | –û—Ç–∫—Ä—ã—Ç–∏–µ | Excel | ‚è≥ –Ω–µ—Ç –ø—Ä–∏–º–µ—Ä–∞ |
| üü¢ 8 | –†–∞–π—Ñ—Ñ–∞–π–∑–µ–Ω | CSV | ‚è≥ –Ω–µ—Ç –ø—Ä–∏–º–µ—Ä–∞ |

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–∞—Ä—Å–µ—Ä–æ–≤:**
```python
# src/parsers/registry.py ‚Äî –∞–≤—Ç–æ-–¥–µ—Ç–µ–∫—Ç —Ñ–æ—Ä–º–∞—Ç–∞ –±–∞–Ω–∫–∞
def detect_and_parse(path: Path) -> pd.DataFrame:
    """–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –±–∞–Ω–∫ –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ —Ñ–∞–π–ª–∞ –∏ –≤—ã–∑—ã–≤–∞–µ—Ç –Ω—É–∂–Ω—ã–π –ø–∞—Ä—Å–µ—Ä."""
    # –°—Ç—Ä–∞—Ç–µ–≥–∏—è: –ø—Ä–æ–±—É–µ–º –ø–æ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–Ω—ã–º –∑–∞–≥–æ–ª–æ–≤–∫–∞–º/—Å—Ç—Ä—É–∫—Ç—É—Ä–µ
    ...

# src/parsers/tinkoff.py ‚Äî –ø—Ä–∏–º–µ—Ä
def parse_tinkoff(path: Path) -> pd.DataFrame:
    """–ü–∞—Ä—Å–∏—Ç CSV-–≤—ã–ø–∏—Å–∫—É –¢–∏–Ω—å–∫–æ—Ñ—Ñ. –ù–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç –∫ –æ–±—â–µ–π —Å—Ö–µ–º–µ."""
    # –ö–æ–ª–æ–Ω–∫–∏: –î–∞—Ç–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏; –î–∞—Ç–∞ –ø–ª–∞—Ç–µ–∂–∞; –°—É–º–º–∞; –°—Ç–∞—Ç—É—Å; ...
    ...
```

**–ï–¥–∏–Ω–∞—è —Å—Ö–µ–º–∞ –≤—ã—Ö–æ–¥–∞** (–æ–¥–∏–Ω–∞–∫–æ–≤–∞ –¥–ª—è –≤—Å–µ—Ö –ø–∞—Ä—Å–µ—Ä–æ–≤):
```
date, amount, is_income, counterparty, purpose, bank_name, account_type
```

### 2.2 –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä –¥–ª—è –ª–∏—á–Ω—ã—Ö –∫–∞—Ä—Ç

–û—Ç–¥–µ–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ (–Ω–µ —Å–º–µ—à–∏–≤–∞—Ç—å —Å –±–∏–∑–Ω–µ—Å-classifier):

| –ü–∞—Ç—Ç–µ—Ä–Ω –≤ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏ | –¢–∏–ø | –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
|---------------------|-----|-----------|-----------|
| "–ü–æ–∫—É–ø–∫–∞ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã" / "P2P" / "–ü–µ—Ä–µ–≤–æ–¥ –Ω–∞ –±–∏—Ä–∂—É" | –ü–µ—Ä–µ–≤–æ–¥ (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π) | ‚Äî | –ù–ï —Ä–∞—Å—Ö–æ–¥! –£–∂–µ –≤ FinanceBot |
| –ü–µ—Ä–µ–≤–æ–¥ –æ—Ç —Ä/—Å DBZ | –ü–µ—Ä–µ–≤–æ–¥ (–ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏–µ) | ‚Äî | –ù–µ –¥–æ—Ö–æ–¥, –∏—Å—Ç–æ—á–Ω–∏–∫ ‚Äî –±–∏–∑–Ω–µ—Å |
| –û–ø–ª–∞—Ç–∞ –∫–∞—Ä—Ç–æ–π (–ø–æ–∫—É–ø–∫–∏) | –†–∞—Å—Ö–æ–¥ | Personal | –õ–∏—á–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã |
| –ü–µ—Ä–µ–≤–æ–¥ –Ω–∞ –≤–∫–ª–∞–¥ | –ü–µ—Ä–µ–≤–æ–¥ (—Å–±–µ—Ä–µ–∂–µ–Ω–∏—è) | ‚Äî | –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π |

**–ö–ª—é—á–µ–≤–æ–µ –ø—Ä–∞–≤–∏–ª–æ:** P2P / –∫—Ä–∏–ø—Ç–∞ —Å –ª–∏—á–Ω—ã—Ö –∫–∞—Ä—Ç = `–ü–µ—Ä–µ–≤–æ–¥ (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π)`, —á—Ç–æ–±—ã –Ω–µ –∑–∞–¥–≤–æ–∏—Ç—å —Ä–∞—Å—Ö–æ–¥—ã —Å FinanceBot.

### 2.3 –ú–∞—Ä–∫–µ—Ç-–∫–∞—Ä—Ç–∞ Modulbank

–û—Ç–¥–µ–ª—å–Ω—ã–π —Å—á—ë—Ç (–Ω–µ —Ä/—Å), –Ω–æ —Ç–æ—Ç –∂–µ —Ñ–æ—Ä–º–∞—Ç –≤—ã–≥—Ä—É–∑–∫–∏ —á—Ç–æ –∏ —Ä/—Å.
- –ù—É–∂–µ–Ω —Ñ–ª–∞–≥ `--account-type marketing_card` –≤ import_statement.py –∏–ª–∏ –∞–≤—Ç–æ–¥–µ—Ç–µ–∫—Ç –ø–æ –Ω–æ–º–µ—Ä—É —Å—á—ë—Ç–∞

### 2.4 Bybit/HTX –∞–¥–∞–ø—Ç–µ—Ä

```python
# src/bybit_adapter.py
def parse_bybit_csv(path: Path) -> pd.DataFrame:
    """–ü–∞—Ä—Å–∏—Ç CSV-–≤—ã–≥—Ä—É–∑–∫—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Å –±–∏—Ä–∂–∏ Bybit."""
    # –ö–æ–ª–æ–Ω–∫–∏: Date, Amount, Asset, Transaction Type, ...
    # –§–∏–ª—å—Ç—Ä: —Ç–æ–ª—å–∫–æ P2P deposits/withdrawals (–∏—Å–∫–ª—é—á–∏—Ç—å trading)
```

- –ù—É–∂–µ–Ω –ø—Ä–∏–º–µ—Ä CSV –∏–∑ Bybit (History ‚Üí All Transactions ‚Üí Export)
- HTX –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ

### 2.5 –†—É—á–Ω–æ–π –≤–≤–æ–¥ –Ω–∞–ª–∏—á–Ω—ã—Ö

```python
# manual_entry.py ‚Äî –ø—Ä–æ—Å—Ç–æ–π CLI –¥–ª—è –∑–∞–ø–∏—Å–∏ –Ω–∞–ª–∏—á–∫–∏
python manual_entry.py add --date 2026-02-20 --amount 15000 --purpose "–ö—É—Ä—å–µ—Ä" --entity DBZ
python manual_entry.py import cash_entries.xlsx  # –º–∞—Å—Å–æ–≤—ã–π –∏–º–ø–æ—Ä—Ç
```

- –•—Ä–∞–Ω–∏—Ç—å –≤ `cash_entries.csv` (–≤ gitignore ‚Äî —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
- –ß–∏—Ç–∞–µ—Ç—Å—è fb_adapter-style, merge_pnl —É—á–∏—Ç—ã–≤–∞–µ—Ç –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫

---

## –§–ê–ó–ê 3: MULTI-ENTITY P&L ‚è≥

**–¶–µ–ª—å:** –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –¥–ª—è –≤—Å–µ—Ö —é—Ä–ª–∏—Ü, –ø–æ–ª—É—á–∏—Ç—å –∫–ª–∞—Å—Ç–µ—Ä–Ω—ã–π –∏ –∫–æ–º–ø–∞–Ω–∏–π–Ω—ã–π P&L.

### 3.1 –î–æ–±–∞–≤–∏—Ç—å –≤—ã–ø–∏—Å–∫–∏ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —é—Ä–ª–∏—Ü

–î–ª—è –∫–∞–∂–¥–æ–≥–æ —é—Ä–ª–∏—Ü–∞: Modulbank —Ä/—Å + –ª–∏—á–Ω—ã–µ –∫–∞—Ä—Ç—ã –≤–ª–∞–¥–µ–ª—å—Ü–∞.

| –Æ—Ä–ª–∏—Ü–æ | –í–ª–∞–¥–µ–ª–µ—Ü | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –°—Ç–∞—Ç—É—Å |
|--------|---------|-----------|--------|
| DBZ | –ù–∞—Ç–∞—à–∞ | ‚úÖ | Modulbank –≥–æ—Ç–æ–≤ |
| MN | –î–µ–Ω–∏—Å | üî¥ | ‚è≥ |
| VAS | –í–∞—Å—è | üî¥ | ‚è≥ |
| LYA | –ò–ª—å—è | üü° | ‚è≥ |
| MAKS | –ú–∞–∫—Å–∏–º | üü° | ‚è≥ |
| LIFE | –û–û–û –®–æ–ø–ø–∏–ª–∞–π—Ñ | üü° | ‚è≥ |
| HUB | ShopHub | üü¢ | ‚è≥ |
| ALEX | –ê–ª–µ–∫—Å–∞–Ω–¥—Ä | üü¢ | ‚è≥ |

### 3.2 –ö–ª–∞—Å—Ç–µ—Ä–Ω—ã–π P&L

–î–æ—Ä–∞–±–æ—Ç–∫–∞ `build_company_pnl()` ‚Üí –¥–æ–±–∞–≤–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å –∫–ª–∞—Å—Ç–µ—Ä–∞:
- WB_NORZ = DBZ + MN: —Å—É–º–º–∏—Ä–æ–≤–∞—Ç—å –¥–æ—Ö–æ–¥—ã/—Ä–∞—Å—Ö–æ–¥—ã
- Shared —Ä–∞—Å—Ö–æ–¥—ã (FinanceBot): –∞–ª–ª–æ—Ü–∏—Ä–æ–≤–∞—Ç—å –ø–æ –∫–ª–∞—Å—Ç–µ—Ä–∞–º –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –¥–æ—Ö–æ–¥—É –∏–ª–∏ –ø–æ—Ä–æ–≤–Ω—É
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–ª–ª–æ–∫–∞—Ü–∏–∏ –≤ clusters.json: `"allocation_method": "revenue_share"` –∏–ª–∏ `"equal"`

### 3.3 –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–∑–º–µ—Ç–∫–∞ FinanceBot —Ä–∞—Å—Ö–æ–¥–æ–≤ –ø–æ —é—Ä–ª–∏—Ü–∞–º

–°–µ–π—á–∞—Å 176/183 FB —Ä–∞—Å—Ö–æ–¥–æ–≤ = "shared". –î–≤–∞ –ø—É—Ç–∏:

**–ü—É—Ç—å A (–±—ã—Å—Ç—Ä—ã–π):** –î–æ–±–∞–≤–∏—Ç—å –§–ò–û —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –≤ entity_patterns
```json
"entity_patterns": {
  "DBZ": ["–î–ë–ó", "DBZ", "–ü–ò–†–û–ñ–ö–û–í", "–ò–í–ê–ù–û–í –ò–í–ê–ù", "–°–ò–î–û–†–û–í–ê –ú–ê–†–ò–Ø"],
  "MN":  ["–î–ï–ù–ò–°", "–ü–ï–¢–†–û–í", ...]
}
```

**–ü—É—Ç—å B (–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π):** –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ "–Æ—Ä–ª–∏—Ü–æ" –≤ FinanceBot –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞—è–≤–∫–∏
- –ú–µ–Ω–µ–¥–∂–µ—Ä –≤—ã–±–∏—Ä–∞–µ—Ç —é—Ä–ª–∏—Ü–æ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–ª–∞—Ç—ë–∂–Ω–æ–π –∑–∞—è–≤–∫–∏
- fb_adapter —á–∏—Ç–∞–µ—Ç —ç—Ç–æ –ø–æ–ª–µ –Ω–∞–ø—Ä—è–º—É—é (–Ω–∞–¥—ë–∂–Ω–µ–µ regex)
- –¢—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ FinanceBot (–æ—Ç–¥–µ–ª—å–Ω–∞—è –∑–∞–¥–∞—á–∞)

### 3.4 `merge_all.py` ‚Äî –∞–≥—Ä–µ–≥–∞—Ç–æ—Ä –≤—Å–µ—Ö —é—Ä–ª–∏—Ü

```bash
# –ó–∞–ø—É—Å–∫–∞–µ—Ç merge_pnl –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —é—Ä–ª–∏—Ü–∞ + –∞–≥—Ä–µ–≥–∏—Ä—É–µ—Ç
python -X utf8 merge_all.py \
  --clusters clusters.json \
  --fb-creds "../FinanceBot/service_account.json" \
  --fb-sheets "1bFBH..." \
  --out pnl_COMPANY.xlsx
```

–í—ã—Ö–æ–¥: P&L –ø–æ –∫–∞–∂–¥–æ–º—É —é—Ä–ª–∏—Ü—É + –∫–ª–∞—Å—Ç–µ—Ä–Ω—ã–π + –æ–±—â–∏–π –∫–æ–º–ø–∞–Ω–∏–π–Ω—ã–π.

---

## –§–ê–ó–ê 4: WB/OZON –§–ò–ù–û–¢–ß–Å–¢–´ ‚è≥

**–¶–µ–ª—å:** –î–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–æ—Ö–æ–¥–Ω—É—é —á–∞—Å—Ç—å (—Å–µ–π—á–∞—Å = –≤—Å—è —Å—É–º–º–∞ –ø—Ä–∏—Ö–æ–¥–∞ –æ—Ç WB/Ozon).

### 4.1 WB —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –æ—Ç—á—ë—Ç—ã

WB –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ –æ—Ç—á—ë—Ç—ã (Excel) —Å —Ä–∞–∑–±–∏–≤–∫–æ–π:
- –ü—Ä–æ–¥–∞–∂–∏ / –í–æ–∑–≤—Ä–∞—Ç—ã / –ö–æ–º–∏—Å—Å–∏—è WB / –õ–æ–≥–∏—Å—Ç–∏–∫–∞ WB / –®—Ç—Ä–∞—Ñ—ã / –ò—Ç–æ–≥–æ –∫ –≤—ã–ø–ª–∞—Ç–µ

```python
# src/wb_report.py
def parse_wb_weekly_report(path: Path) -> pd.DataFrame:
    """–ü–∞—Ä—Å–∏—Ç –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π –æ—Ç—á—ë—Ç WB."""
    # –ù—É–∂–µ–Ω –ø—Ä–∏–º–µ—Ä –æ—Ç—á—ë—Ç–∞ –∏–∑ –ª–∏—á–Ω–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞ WB
```

### 4.2 Ozon —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –æ—Ç—á—ë—Ç—ã

–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ WB, –¥—Ä—É–≥–æ–π —Ñ–æ—Ä–º–∞—Ç.

### 4.3 –ö—Ä–æ—Å—Å-–ø—Ä–æ–≤–µ—Ä–∫–∞

–°–≤–µ—Ä–∫–∞: —Å—É–º–º–∞ –≤—ã–ø–ª–∞—Ç –ø–æ WB/Ozon –æ—Ç—á—ë—Ç–∞–º = –ø—Ä–∏—Ö–æ–¥—ã –æ—Ç WB/Ozon –ò–ù–ù –Ω–∞ —Ä/—Å.
- WB –ò–ù–ù: 7704217370 ‚Äî —É–∂–µ –≤ classifier.py
- Ozon –ò–ù–ù: 7704217370 (–¥–æ–±–∞–≤–∏—Ç—å –≤ classifier.py ‚Äî —Å–º. Q-C)

---

## –§–ê–ó–ê 5: GOOGLE SHEETS –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø ‚è≥

**–¶–µ–ª—å:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–∏—Å–∞—Ç—å –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ Google Sheets (–∑–∞–º–µ–Ω–∞ —Ä—É—á–Ω–æ–≥–æ –∂—É—Ä–Ω–∞–ª–∞).

### 5.1 –°—Ö–µ–º–∞ –Ω–æ–≤–æ–≥–æ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–≥–æ –∂—É—Ä–Ω–∞–ª–∞

```
Google Sheets: "–ï–¥–∏–Ω—ã–π –∂—É—Ä–Ω–∞–ª" (–æ–¥–∏–Ω –ª–∏—Å—Ç, –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π)
–ö–æ–ª–æ–Ω–∫–∏: –î–∞—Ç–∞ | –Æ—Ä–ª–∏—Ü–æ | –ö–ª–∞—Å—Ç–µ—Ä | –¢–∏–ø | –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –°—É–º–º–∞ | –í–∞–ª—é—Ç–∞ |
         –ò—Å—Ç–æ—á–Ω–∏–∫ | –ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –¢–µ–≥–∏ | –°—Ç–∞—Ç—É—Å
```

–ü—Ä–∏–Ω—Ü–∏–ø: –∫–∞–∂–¥–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è = –æ–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞. –ù–µ—Ç –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è.

### 5.2 –°–∫—Ä–∏–ø—Ç –∑–∞–≥—Ä—É–∑–∫–∏

```python
# upload_journal.py
python -X utf8 upload_journal.py \
  --journal unified_journal.csv \
  --sheets-id "SHEET_ID" \
  --creds service_account.json
```

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `tabular-schema-evolution` —Å–∫–∏–ª–ª ‚Äî –∞—Ä—Ö–∏–≤–∏—Ä—É–µ—Ç —Å—Ç–∞—Ä—ã–π –ª–∏—Å—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ö–µ–º—ã.

### 5.3 –§–æ—Ä–º—É–ª—ã-–¥–∞—à–±–æ—Ä–¥–∞

–í Google Sheets: –æ—Ç–¥–µ–ª—å–Ω—ã–π –ª–∏—Å—Ç "Dashboard" —Å QUERY/SUMIFS —Ñ–æ—Ä–º—É–ª–∞–º–∏ –¥–ª—è:
- P&L –ø–æ –º–µ—Å—è—Ü–∞–º
- –ë–∞–ª–∞–Ω—Å –ø–æ —Å—á–µ—Ç–∞–º
- –¢–æ–ø —Ä–∞—Å—Ö–æ–¥–æ–≤ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º

---

## –§–ê–ó–ê 6: –ê–í–¢–û–ú–ê–¢–ò–ó–ê–¶–ò–Ø ‚è≥

**–¶–µ–ª—å:** –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ä—É—á–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –ø—Ä–∏ –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏.

### 6.1 Telegram AccountingBot

–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ FinanceBot –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—ã–π –±–æ—Ç:
- `/upload` ‚Äî –∑–∞–≥—Ä—É–∑–∏—Ç—å XLSX –≤—ã–ø–∏—Å–∫—É ‚Üí –ø–∞—Ä—Å–∏–Ω–≥ ‚Üí –∑–∞–ø–∏—Å—å –≤ –∂—É—Ä–Ω–∞–ª
- `/balance` ‚Äî —Ç–µ–∫—É—â–∏–µ –±–∞–ª–∞–Ω—Å—ã –ø–æ —Å—á–µ—Ç–∞–º
- `/pnl [entity] [period]` ‚Äî P&L —Å–≤–æ–¥–∫–∞ –≤ —á–∞—Ç
- `/missing` ‚Äî —Å–ø–∏—Å–æ–∫ –æ–ø–µ—Ä–∞—Ü–∏–π –±–µ–∑ —Ç–µ–≥–∞ —é—Ä–ª–∏—Ü–∞

### 6.2 –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ (cron / Windows Task Scheduler)

```bash
# –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ: –æ–±–Ω–æ–≤–∏—Ç—å P&L
python -X utf8 merge_all.py --auto --upload-sheets
```

### 6.3 –ê–ª–µ—Ä—Ç—ã

- –û–ø–µ—Ä–∞—Ü–∏—è >500k –±–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ‚Üí —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram
- –ñ—É—Ä–Ω–∞–ª –Ω–µ –æ–±–Ω–æ–≤–ª—è–ª—Å—è >7 –¥–Ω–µ–π ‚Üí –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ
- USDT –±–∞–ª–∞–Ω—Å –Ω–∞ Bybit <1000 USDT ‚Üí –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ

---

## –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò—à–∞–≥–∏ (–±–ª–∏–∂–∞–π—à–∏–µ –¥–µ–π—Å—Ç–≤–∏—è)

### –°–µ–π—á–∞—Å –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å (–±–µ–∑ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö)

- [ ] –î–æ–±–∞–≤–∏—Ç—å –ò–ù–ù Ozon –≤ `src/classifier.py` (INN = 7704217370 –∏–ª–∏ —É—Ç–æ—á–Ω–∏—Ç—å)
- [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å Jul 2026 –∞–Ω–æ–º–∞–ª–∏—é –≤ FinanceBot Sheets (–Ω–∞–π—Ç–∏ –∑–∞–ø–∏—Å—å —Å –Ω–µ–≤–µ—Ä–Ω–æ–π –¥–∞—Ç–æ–π)
- [ ] –ó–∞–∫—Ä—ã—Ç—å 8 –ø—Ä–æ–ø—É—Å–∫–æ–≤ –∏–∑ diff_DBZ.xlsx (–≤–Ω–µ—Å—Ç–∏ –≤ —Ä—É—á–Ω–æ–π –∂—É—Ä–Ω–∞–ª –≤—Ä—É—á–Ω—É—é)
- [ ] –û–±–æ–≥–∞—Ç–∏—Ç—å `entity_patterns` –≤ clusters.json ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –§–ò–û –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π DBZ –∏–∑ FinanceBot
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Q-F: +500k –æ—Ç –ë–ê–ù–ö –í–¢–ë (2026-01-16) ‚Äî —á—Ç–æ —ç—Ç–æ?
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Q-E: 4 –∑–∞–ø–∏—Å–∏ "—Ç–æ–ª—å–∫–æ –≤ –∂—É—Ä–Ω–∞–ª–µ" ‚Äî FinanceBot? –¥—Ä—É–≥–æ–π –±–∞–Ω–∫?

### –ñ–¥—ë–º —Ñ–∞–π–ª—ã –¥–ª—è –ø–∞—Ä—Å–µ—Ä–æ–≤

–ü—Ä–∏—Å–ª–∞—Ç—å –ø—Ä–∏–º–µ—Ä—ã –≤—ã–≥—Ä—É–∑–æ–∫ (–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ–±–µ–∑–ª–∏—á–∏—Ç—å —Å—É–º–º—ã):
- [ ] –¢–∏–Ω—å–∫–æ—Ñ—Ñ CSV ‚Äî —Å–∞–º—ã–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–π
- [ ] –ê–ª—å—Ñ–∞ CSV
- [ ] –°–±–µ—Ä–±–∞–Ω–∫ Excel
- [ ] –í–¢–ë CSV/Excel
- [ ] Bybit CSV (History ‚Üí Transactions ‚Üí Export CSV)

### –ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤

1. –ù–∞–ø–∏—Å–∞—Ç—å `src/parsers/tinkoff.py` + `src/parsers/registry.py` (–∞–≤—Ç–æ-–¥–µ—Ç–µ–∫—Ç)
2. –î–æ–±–∞–≤–∏—Ç—å –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ª–∏—á–Ω—ã—Ö –∫–∞—Ä—Ç (—Å –ø—Ä–∞–≤–∏–ª–æ–º –∏—Å–∫–ª—é—á–µ–Ω–∏—è P2P-–∫—Ä–∏–ø—Ç–∞)
3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ–ª–Ω—ã–π –∫—ç—à—Ñ–ª–æ—É DBZ: —Ä/—Å + –≤—Å–µ –∫–∞—Ä—Ç—ã + FinanceBot + –Ω–∞–ª–∏—á–Ω—ã–µ
4. –ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–ª—è MN, VAS ‚Äî –ø–æ–ª—É—á–∏—Ç—å –ø–µ—Ä–≤—ã–π –∫–ª–∞—Å—Ç–µ—Ä–Ω—ã–π P&L WB_NORZ

---

## –¢–ï–•–î–û–õ–ì

| –ó–∞–¥–∞—á–∞ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|-----------|---------|
| –ü–∞—Ä—Å–µ—Ä –∞–≤—Ç–æ-–¥–µ—Ç–µ–∫—Ç | üî¥ | `detect_bank_format(path)` —á—Ç–æ–±—ã `--bank` –Ω–µ —Ç—Ä–µ–±–æ–≤–∞–ª —É–∫–∞–∑—ã–≤–∞—Ç—å —Ç–∏–ø |
| -0.00 –≤ –≤—ã–≤–æ–¥–µ | üü¢ | –ö–æ—Å–º–µ—Ç–∏–∫–∞: `fillna(0).replace(-0.0, 0.0)` |
| –¢–µ—Å—Ç fb_adapter | üü° | Mock Sheets –¥–ª—è unit-—Ç–µ—Å—Ç–æ–≤ –±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è |
| –ö—ç—à Sheets | üü° | –°–æ—Ö—Ä–∞–Ω—è—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç fb_adapter –≤ CSV —á—Ç–æ–±—ã –Ω–µ –¥–µ–ª–∞—Ç—å 4 API-–∑–∞–ø—Ä–æ—Å–∞ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—É—Å–∫–µ |
| Decimal ‚Üí float | üü¢ | –°—É–º–º—ã –±–∞–Ω–∫–∞ –ª—É—á—à–µ —Ö—Ä–∞–Ω–∏—Ç—å –≤ Decimal –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏ |

---

## –°–°–´–õ–ö–ò

| –†–µ—Å—É—Ä—Å | –ó–Ω–∞—á–µ–Ω–∏–µ |
|--------|---------|
| FinanceBot Sheets | `1bFBHIB53h7TJBknJatJn_y__11jCIP45ZbGsatnb1G4` |
| Service Account | `Projects/FinanceBot/service_account.json` |
| Modulbank –≤—ã–ø–∏—Å–∫–∞ DBZ | `Projects/BusinessBank/–ü—Ä–∏–º–µ—Ä—ã –≤—ã–ø–∏—Å–æ–∫ –∏–∑ –ú–æ–¥—É–ª—å–±–∞–Ω–∫–∞/` |
| –†—É—á–Ω–æ–π –∂—É—Ä–Ω–∞–ª DBZ | `Projects/–§–∏–Ω–∞–Ω—Å–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞/–ñ—É—Ä–Ω–∞–ª –æ–ø–µ—Ä–∞—Ü–∏–π –î–ë–ó .xlsx` |
| clusters.json | `Projects/BusinessBank/clusters.json` |
