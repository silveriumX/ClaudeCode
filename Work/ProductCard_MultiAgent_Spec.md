# Мультиагентная система: карточки товара из фото

**Цель:** по вашим фото товара автоматически получать карточки в стиле образцов (моющий пылесос / беспроводной пылесос): заголовок, характеристики, блоки-выноски, компоновка.

---

## 1. Образцы и что из них извлекать

### Образец A (моющий пылесос)
- **Макет:** продукт по центру, серый градиент, выноски вокруг.
- **Текст:** главный заголовок («МОЮЩИЙ ПЫЛЕСОС»), подзаголовок-применение («чистка мебели • чистка ковров»).
- **Блоки:** гарантия (2 года), происхождение («немецкие технологии» + флаг), комплект (2 насадки), мощность (3 600 Вт).
- **Визуал:** овал под гарантию, акцент на цифрах, одна доминирующая фотография товара.

### Образец B (беспроводной пылесос)
- **Макет:** две колонки — тёмная панель (текст + иконки) слева, светлая зона с товаром справа.
- **Текст:** «беспроводной», «Мощный», список характеристик с иконками (19 000 Па, 3 режима, 45 мин), «универсален для» (дом/авто/офис), «3 насадки» с миниатюрами.
- **Визуал:** полупрозрачный крупный текст «ПЫЛЕСОС» на фоне, жёлтые акценты на продукте.

**Общее для системы:**
- Из фото нужно извлекать: тип товара, категорию, визуально читаемые характеристики (мощность, время работы, количество насадок и т.п.).
- Генерировать: заголовок, подзаголовок, 3–6 блоков-выносок (цифра + короткий текст), при необходимости список «универсален для».
- Выбирать один из двух (или больше) шаблонов карточки и подставлять данные.

---

## 2. Архитектура мультиагентной системы

```
[Фото товара] → [Подготовка изображения] → [Vision-агент] → [Структурированные данные]
                     ↑                           ↓
              CardDesigner pipeline      [Копирайт-агент] → тексты RU
                     ↓                           ↓
              [Рендер-агент] ← [Шаблон + данные + обработанное фото]
                     ↓
              [Карточка товара (PNG/HTML)]
```

### Агент 1: Подготовка изображения (уже есть — CardDesigner)
- Вход: сырое фото товара.
- Действия: удаление фона, при необходимости апскейл/улучшение, нормализация размера и пропорций.
- Выход: «чистое» фото товара на нейтральном фоне, подходящее для вставки в карточку.

### Агент 2: Vision (анализ фото)
- Вход: обработанное фото (и при желании сырое для контекста).
- Задачи:
  - Определить категорию товара (например: пылесос моющий / вертикальный беспроводной / и т.д.).
  - Извлечь всё, что можно прочитать или оценить: мощность (Вт, Па), время работы (мин), количество насадок, страна/бренд (если видно).
  - Предложить короткие формулировки применений (чистка ковров, мебели, авто, офис).
- Выход: структурированный JSON (см. раздел 3).

### Агент 3: Копирайт (тексты на русском)
- Вход: JSON от Vision + выбранный шаблон карточки.
- Задачи:
  - Сгенерировать главный заголовок (например «МОЮЩИЙ ПЫЛЕСОС», «БЕСПРОВОДНОЙ ПЫЛЕСОС»).
  - Подзаголовок или слоган (применения, ключевое преимущество).
  - Тексты для каждого блока: гарантия, технологии, комплект, мощность, «универсален для» и т.д.
  - Соблюдать стиль образцов: короткие фразы, цифры выделены.
- Выход: тот же JSON с заполненными полями `title`, `subtitle`, `callouts[]`, `universal_for` и т.д.

### Агент 4: Выбор шаблона (минимальная логика или отдельный микро-агент)
- Вход: категория товара, количество блоков, есть ли «универсальность».
- Правила примерные:
  - Моющий/напольный, один главный акцент (мощность, гарантия, комплект) → шаблон типа образца A.
  - Беспроводной, несколько чётких характеристик (Па, режимы, время, насадки) → шаблон типа образца B.
- Выход: идентификатор шаблона (template_a / template_b) и при необходимости варианты layout (например «с большим фонтовым текстом» для B).

### Агент 5: Рендер карточки
- Вход: выбранный шаблон, обработанное фото, итоговый JSON (тексты + блоки).
- Задачи:
  - Подставить фото в зону продукта.
  - Разместить заголовок, подзаголовок, блоки-выноски по макету шаблона.
  - Отрисовать овалы, иконки, миниатюры насадок (если есть отдельные фото — вставить; если нет — заглушки или пропуск).
- Выход: PNG (или HTML для вёрстки), размер под маркетплейс/лендинг (например 1200×1600 или по вашему стандарту).

---

## 3. Модель данных (единый JSON между агентами)

```json
{
  "category": "washing_vacuum",
  "template_id": "template_a",
  "title": "МОЮЩИЙ ПЫЛЕСОС",
  "subtitle": "чистка мебели • чистка ковров",
  "callouts": [
    { "type": "warranty", "value": "2", "unit": "года гарантии", "emphasis": "value" },
    { "type": "origin", "text": "немецкие технологии", "icon": "flag_de" },
    { "type": "accessories", "value": "2", "unit": "насадки в комплекте", "emphasis": "value" },
    { "type": "power_w", "value": "3 600", "unit": "Вт мощность", "emphasis": "value" }
  ],
  "specs": {
    "power_w": 3600,
    "power_pa": null,
    "runtime_min": null,
    "speed_modes": null
  },
  "universal_for": null,
  "product_image_path": "path/to/processed.png",
  "accessory_images": []
}
```

Для шаблона B добавляются, например:
- `specs.power_pa`, `specs.runtime_min`, `specs.speed_modes`
- `universal_for`: `["дом", "авто", "офис"]`
- `callouts` с иконками (всасывание, режимы, батарея)
- `accessory_images` для блока «3 насадки»

Vision заполняет `category`, `specs`, при необходимости черновые `callouts`; копирайт заполняет `title`, `subtitle`, все тексты в `callouts` и `universal_for`; рендер читает `template_id` и все поля и рисует карточку.

---

## 4. Стек и реализация

| Компонент        | Варианты |
|------------------|----------|
| Vision           | Claude Vision API, GPT-4 Vision, Gemini Vision (см. ваш выбор по задаче «документы/характеристики») |
| Копирайт         | Тот же LLM с промптом «стиль как в образцах», можно отдельная модель |
| Подготовка фото  | Текущий CardDesigner (Python, rembg, upscale, нормализация) |
| Рендер           | Python: Pillow + шаблоны (разметка координат блоков в JSON шаблона); либо HTML/CSS → screenshot; либо Figma API / Canva API при необходимости |
| Оркестрация      | Один скрипт (Python) или простой пайплайн (например, один модуль `orchestrator.py`, вызывает по очереди CardDesigner → Vision → Копирайт → Рендер) |

Рекомендация по Vision: для товарных карточек с текстом и цифрами на устройстве хорошо подходят Claude Vision или GPT-4 Vision; первый часто удобнее для структурированного вывода (JSON).

---

## 5. Пошаговый план внедрения

1. **Зафиксировать JSON-схему** (поля для шаблонов A и B) и примеры «идеального» JSON по обоим образцам.
2. **Реализовать Vision-агента:** промпт + вызов API с фото, парсинг JSON из ответа; подставить в схему.
3. **Реализовать Копирайт-агента:** на вход JSON от Vision + имена шаблонов; на выход тот же JSON с заполненными текстами.
4. **Описать шаблоны в коде:** для A и B задать размер карточки, зоны (x, y, ширина, высота) для заголовка, подзаголовка, каждого callout, фото товара; хранить в конфиге или JSON.
5. **Реализовать Рендер:** загрузка обработанного фото из CardDesigner, подстановка в шаблон, отрисовка текста и блоков (Pillow или HTML).
6. **Связать пайплайн:** вход — путь к фото; вызов CardDesigner → сохранение обработанного файла → Vision → Копирайт → выбор шаблона → Рендер → сохранение карточки.
7. **Итерации:** подбор промптов Vision/Копирайт под ваши товары, добавление новых шаблонов при необходимости.

---

## 6. Где хранить и как расширять

- **Спека и контекст для агентов:** этот файл (`Work/ProductCard_MultiAgent_Spec.md`) + скриншоты образцов в папке `Work/ProductCard/` (или в `Projects/CardDesigner/`) как референс для промптов.
- **Код:** логично положить оркестратор и агентов в `Projects/CardDesigner/` (рядом с `image_processor`), например:
  - `agents/vision.py`, `agents/copywriter.py`, `agents/render.py`
  - `templates/template_a.json`, `template_b.json` (координаты и стили блоков)
  - `orchestrator.py` — входная точка по одному фото или по папке с фото.

После этого мультиагентная система будет из ваших фото товара собирать карточки, визуально и по структуре близкие к образцам.
