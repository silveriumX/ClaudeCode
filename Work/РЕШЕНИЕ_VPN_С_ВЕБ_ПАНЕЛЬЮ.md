# Решение: WireGuard VPN + Веб-панель управления

**Цель:** Полная защита от утечек + удобный интерфейс для нетехнического пользователя

---

## Итоговая архитектура

```
┌─────────────────────────────────────────────────────────────────┐
│                    УПРАВЛЕНИЕ (Ты)                               │
│  ├── Веб-панель wg-easy: https://vpn.твойдомен.com              │
│  ├── SSH для продвинутого управления                             │
│  └── Telegram бот (опционально)                                  │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                    VPS (WireGuard Server)                        │
│  IP: 62.84.101.97 (или любой другой VPS)                        │
│  ├── Docker + wg-easy (веб-панель)                               │
│  ├── WireGuard интерфейс wg0                                     │
│  └── Маршрутизация через SOCKS5 прокси                           │
│      └── 185.162.130.86:10001 (внешний IP для клиентов)          │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                    КЛИЕНТЫ (Пользователи)                        │
│  ├── WireGuard GUI для Windows/Mac/iOS/Android                   │
│  ├── QR-код для мобильных устройств                              │
│  └── Одна кнопка "Подключить"                                    │
│                                                                  │
│  Результат:                                                      │
│  ✅ DNS через VPN → через прокси                                 │
│  ✅ WebRTC показывает IP прокси                                  │
│  ✅ Весь трафик защищён                                          │
└─────────────────────────────────────────────────────────────────┘
```

---

## wg-easy — Веб-панель для WireGuard

### Что это?
- Простейший веб-интерфейс для WireGuard
- Docker контейнер — установка за 5 минут
- QR-коды для мобильных клиентов
- Управление пользователями в браузере

### Скриншот интерфейса

```
┌─────────────────────────────────────────────────────────────┐
│  WireGuard Easy                              [+ New Client] │
├─────────────────────────────────────────────────────────────┤
│  Name          Status       IP            Actions           │
│  ───────────────────────────────────────────────────────────│
│  📱 Телефон    🟢 Online    10.0.0.2      [QR] [📥] [🗑️]   │
│  💻 Рабочий    ⚪ Offline   10.0.0.3      [QR] [📥] [🗑️]   │
│  🖥️ Сервер1   🟢 Online    10.0.0.4      [QR] [📥] [🗑️]   │
└─────────────────────────────────────────────────────────────┘

[+ New Client] → Ввести имя → Получить QR-код и конфиг
```

### Установка на VPS (5 минут)

```bash
# 1. Установить Docker
curl -fsSL https://get.docker.com | sh

# 2. Запустить wg-easy
docker run -d \
  --name wg-easy \
  -e WG_HOST=62.84.101.97 \
  -e PASSWORD=ТвойПароль \
  -e WG_DEFAULT_DNS=1.1.1.1 \
  -e WG_ALLOWED_IPS=0.0.0.0/0,::/0 \
  -v ~/.wg-easy:/etc/wireguard \
  -p 51820:51820/udp \
  -p 51821:51821/tcp \
  --cap-add NET_ADMIN \
  --cap-add SYS_MODULE \
  --sysctl net.ipv4.ip_forward=1 \
  --sysctl net.ipv4.conf.all.src_valid_mark=1 \
  --restart unless-stopped \
  ghcr.io/wg-easy/wg-easy

# 3. Открыть веб-панель
# https://62.84.101.97:51821
```

---

## Для нетехнического пользователя

### Что видит пользователь:

**Шаг 1:** Получает QR-код или конфиг файл от администратора

**Шаг 2:** Устанавливает WireGuard (бесплатно)
- Windows: https://wireguard.com/install/
- iOS: App Store → WireGuard
- Android: Google Play → WireGuard

**Шаг 3:** Сканирует QR-код или импортирует конфиг

**Шаг 4:** Нажимает "Activate"

**Готово!** Весь трафик защищён.

### Интерфейс WireGuard клиента

```
┌─────────────────────────────────────┐
│  WireGuard                    [≡]   │
├─────────────────────────────────────┤
│                                     │
│  🔒 Рабочий VPN                     │
│     Status: Inactive                │
│                                     │
│     [ ████ Activate ████ ]          │
│                                     │
│  ─────────────────────────────────  │
│  Transfer: ↓ 0 B  ↑ 0 B            │
│  Last handshake: never              │
└─────────────────────────────────────┘

После нажатия "Activate":

┌─────────────────────────────────────┐
│  WireGuard                    [≡]   │
├─────────────────────────────────────┤
│                                     │
│  🔒 Рабочий VPN                     │
│     Status: ✅ Active               │
│                                     │
│     [ ████ Deactivate ████ ]        │
│                                     │
│  ─────────────────────────────────  │
│  Transfer: ↓ 1.2 MB  ↑ 340 KB      │
│  Last handshake: 5 seconds ago      │
└─────────────────────────────────────┘
```

---

## Маршрутизация через SOCKS5 прокси

Если нужно чтобы IP клиентов был **не IP VPS**, а **IP прокси сервера** (185.162.130.86):

### Вариант 1: NAT через прокси на VPS

```bash
# На VPS настроить redsocks для NAT через SOCKS5
# Весь исходящий трафик → через 185.162.130.86:10001
```

### Вариант 2: VPN цепочка

```
Клиент → WireGuard (VPS) → SOCKS5 прокси → Интернет
```

Настраивается через iptables + redsocks на VPS.

---

## Защита от утечек: Чеклист

### DNS утечки
- [x] `WG_DEFAULT_DNS=1.1.1.1` в конфиге wg-easy
- [x] `AllowedIPs=0.0.0.0/0` — весь трафик через VPN

### WebRTC утечки
- [x] VPN меняет IP на системном уровне
- [x] WebRTC видит IP VPN/прокси
- [ ] Дополнительно: отключить WebRTC в браузере

### IP утечки
- [x] `AllowedIPs=0.0.0.0/0,::/0` — весь IPv4 и IPv6 через VPN
- [x] Kill switch (опционально) — блокировать трафик если VPN отключен

---

## План внедрения

### День 1: Установка wg-easy
1. SSH на VPS
2. Установить Docker
3. Запустить wg-easy
4. Настроить firewall (открыть 51820/udp, 51821/tcp)

### День 2: Настройка маршрутизации через прокси (если нужно)
1. Установить redsocks
2. Настроить NAT через SOCKS5 прокси
3. Проверить что IP = IP прокси

### День 3: Создание клиентов
1. Через веб-панель создать клиентов
2. Скачать конфиги / сгенерировать QR-коды
3. Раздать пользователям

### День 4: Тестирование
1. Подключиться к VPN
2. Проверить на ipleak.net — нет ли утечек
3. Проверить WebRTC на browserleaks.com/webrtc

---

## Итог

| Аспект | Решение |
|--------|---------|
| **Защита от утечек** | WireGuard VPN (весь трафик) |
| **DNS защита** | DNS через VPN |
| **WebRTC защита** | IP = IP VPN/прокси |
| **Интерфейс админа** | Веб-панель wg-easy |
| **Интерфейс пользователя** | WireGuard GUI + одна кнопка |
| **SSH управление** | Полный доступ к серверу |
| **Цена** | Бесплатно (только VPS) |

**Хочешь начать установку wg-easy на сервер?**
