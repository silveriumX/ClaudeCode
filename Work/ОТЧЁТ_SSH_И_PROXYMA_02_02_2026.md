# Отчёт: SSH к серверу 62.84.101.97 и Proxyma API

**Дата:** 02.02.2026
**Задачи:**
1) Проверить возможность менять реквизиты прокси и маршруты в Proxifier через SSH (без прямого подключения к машине).
2) Проверить возможность создавать прокси-листы в Proxyma по API (api_key + package_key).

---

## 1) SSH и файл Proxifier (Proxy Fire)

**Результат: да, менять можно.**

- **Подключение:** SSH к `62.84.101.97` под пользователем `Administrator` с указанным паролем — успешно (paramiko).
- **Профиль Proxifier:** найден по пути
  `C:\Users\Administrator\AppData\Roaming\Proxifier4\Profiles\Default.ppx`
- **Изменение реквизитов/маршрутов:** через SSH можно выполнять PowerShell и править файл `.ppx`: подставлять новый блок `<ProxyList>...</ProxyList>` (как в команде **set_proxy** в ServerManager). Перезапуск Proxifier после правки тоже делается командами по SSH.

**Как это уже реализовано:**
В `Projects/ServerManager/server-monitor-package/command_handler.py` команда **set_proxy** формирует PowerShell-скрипт, который:
- находит профиль (APPDATA\Proxifier4\Profiles\Default.ppx или ProgramData\Proxifier);
- подменяет `<ProxyList>...</ProxyList>` или `<ProxyList />` новыми данными прокси;
- при необходимости перезапускает Proxifier.

Вывод: **перенастраивать Proxy Fire (Proxifier) через SSH без прямого подключения к машине можно** — либо через существующую логику set_proxy (таблица → команда на сервер), либо своим скриптом с paramiko по тому же принципу.

---

## 2) Proxyma API — создание прокси-листа

**Учётные данные (из запроса):**
- **Package Key (ID пакета):** `1fb08611c4d557ac8f22`
- **API Key:** `n2yhff6z7fC1VBBKi8QvoGeSr9LYm5Li`

**Проверено:**

| Проверка | Результат |
|----------|-----------|
| GET `https://api.proxyma.io/api/residential/packages` с заголовком `api-key` | **200** — список пакетов получен |
| Пакет `1fb08611c4d557ac8f22` в списке | **Найден**, статус **active** |
| POST создание прокси-листа | **404** (и на `proxyma.io`, и на `api.proxyma.io`) |

**Эндпоинты создания прокси по документации Proxyma:**
`POST https://proxyma.io/api/create/proxy` (в доке указан именно этот URL).
Фактически запрос возвращает HTML (страница сайта), то есть такого API-пути на стороне сервера нет или он перенесён.

**Итог по Proxyma:**
- **Создавать прокси-листы по текущему публичному API** (с api_key и package_key) **не получается** — эндпоинт create proxy отвечает 404.
- **Читать пакеты и проверять статус пакета по API можно** — api_key и package_key валидны, пакет активен.

**Что можно сделать дальше:**
- Уточнить у поддержки Proxyma актуальный URL/метод для создания прокси-листа по API (residential или другой раздел).
- Проверить личный кабинет (cabinet.proxyma.io): возможно, создание листов доступно только через UI или отдельный (reseller) API.

---

## 3) Способы добиться цели без прямого доступа к машине

### A) Уже есть: изменение Proxifier по SSH

- Использовать **ServerManager**: в таблице задать реквизиты прокси (и при необходимости маршруты), на сервер 62.84.101.97 отправить команду **set_proxy**. Выполнение идёт по SSH (или WinRM), файл Default.ppx правится на сервере.
- Либо свой скрипт: подключение по SSH (paramiko), выполнение того же PowerShell-сценария подстановки `<ProxyList>...</ProxyList>` в .ppx.

### B) Агент/скрипт для полного цикла (Proxyma → сервер)

Если позже Proxyma даст рабочий API создания прокси-листа:

1. **Скрипт/агент (локально или на сервере):**
   - по расписанию или по запросу вызывает Proxyma API (create proxy или получение списка прокси по пакету);
   - получает актуальные реквизиты (хост, порт, логин, пароль);
   - по SSH к 62.84.101.97 выполняет обновление Proxifier (аналог set_proxy с подстановкой нового прокси в .ppx).
2. **Учётные данные:** api_key и package_key Proxyma хранить в `.env` или в защищённом хранилище; пароль SSH — в .env или в секретах (не в коде).

Пока create proxy даёт 404, агент может:
- только **читать** пакет и статус по API;
- **обновлять Proxifier по SSH**, если реквизиты прокси задаются вручную или приходят из другого источника (например, из таблицы ServerManager).

### C) Резерв: только ручное обновление

- В таблице серверов (Google Sheets / локальный JSON) задать реквизиты прокси для 62.84.101.97.
- Отправлять команду **set_proxy** на этот сервер через ServerManager — без Proxyma API, но с полным контролем реквизитов и маршрутов через SSH.

---

## Файлы и скрипты

- **Скрипт проверки:** `Scripts/verify_ssh_and_proxyma.py`
  — подключается по SSH к 62.84.101.97, проверяет наличие профиля Proxifier; дергает Proxyma API (packages + create proxy). Запуск:
  `python Scripts/verify_ssh_and_proxyma.py`
- **Логика set_proxy (SSH):** `Projects/ServerManager/server-monitor-package/command_handler.py` (команда `set_proxy`) и `ssh_connector.py`.

---

## Краткий итог

| Вопрос | Ответ |
|--------|--------|
| Менять реквизиты и маршруты в Proxifier через SSH без прямого входа на сервер? | **Да** — через set_proxy или свой скрипт по SSH. |
| Создавать прокси-листы в Proxyma по api_key и package_key? | **Сейчас нет** — эндпоинт create proxy возвращает 404; чтение пакетов и статуса по API работает. |
| Вариант автоматизации (Proxyma → сервер)? | Агент/скрипт: после появления рабочего API создания листов — вызов API → подстановка реквизитов в Proxifier по SSH; пока можно автоматизировать только обновление Proxifier по уже известным реквизитам (из таблицы или .env). |
