---
name: ocr-structured-text
description: OCR image/PDF to structured text - use block/paragraph layout from Vision API, filter garbage. Use when adding OCR to documents, screenshots, or PDFs; when user mentions Vision API or document recognition.
---

# OCR: структурированный текст и очистка

## Правила

### 1. Использовать структуру ответа API

- Не ограничиваться одним полем `full_text_annotation.text`. Использовать **блоки и параграфы** из ответа (`annotation.pages[].blocks[].paragraphs`), собирать текст по параграфам и вставлять переносы строк/пустые строки между блоками. Так сохраняются абзацы и читаемость.

### 2. Постобработка (фильтрация мусора)

- Отбрасывать строки длиной 1–2 символа (обрывки OCR).
- Фильтровать типичный UI-текст с экрана (например «Яндекс.Карты», «оставьте отзыв», «Google Maps»), чтобы он не попадал в итоговый текст.
- Схлопывать множественные пустые строки в одну.

### 3. PDF

- Обрабатывать постранично (например первые 5 страниц через batch API); между страницами вставлять явный разделитель (`---`), чтобы было видно границы страниц.

### 4. Извлечение полей (тип документа, дата, ФИО)

- Не полагаться на хрупкие regex по сырому OCR для сложных документов. Для надёжного извлечения полей использовать **LLM** по уже распознанному тексту — см. `/openai-json-extraction`.

### 5. Сохранение результата

- Итоговый текст сохранять в UTF-8 (файл .txt или запись в хранилище). При записи в Google Drive использовать `webViewLink` или ссылку вида `/view` для просмотра, не force-download.
