# Financial Journal Schema

> –°—Ö–µ–º–∞ –µ–¥–∏–Ω–æ–≥–æ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–≥–æ –∂—É—Ä–Ω–∞–ª–∞ –≤ Google Sheets –¥–ª—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ FinanceBot –∏ –±–∞–Ω–∫–æ–≤—Å–∫–∏—Ö –≤—ã–ø–∏—Å–æ–∫.
> –û—Å–Ω–æ–≤–∞ –¥–ª—è P&L, Cash Flow –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏.

---

## –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

- –°–æ–∑–¥–∞—ë—à—å –Ω–æ–≤—É—é Google Sheets —Ç–∞–±–ª–∏—Ü—É –¥–ª—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–≥–æ —É—á—ë—Ç–∞
- –î–æ–±–∞–≤–ª—è–µ—à—å –Ω–æ–≤—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö (–±–∞–Ω–∫, –±–æ—Ç)
- –ü—Ä–æ–µ–∫—Ç–∏—Ä—É–µ—à—å —Å—Ö–µ–º—É –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç—á—ë—Ç–Ω–æ—Å—Ç–∏

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã

```
–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –∂—É—Ä–Ω–∞–ª (Google Spreadsheet)
‚îÇ
‚îú‚îÄ‚îÄ üìã –ñ—É—Ä–Ω–∞–ª —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π     ‚Üê –í–°–ï –æ–ø–µ—Ä–∞—Ü–∏–∏ (bank + financebot)
‚îú‚îÄ‚îÄ üè¶ –°—á–µ—Ç–∞                 ‚Üê –°–ø–∏—Å–æ–∫ —Ä/—Å –∏ –∏—Ö –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç—å
‚îú‚îÄ‚îÄ üè∑Ô∏è –ö–∞—Ç–µ–≥–æ—Ä–∏–∏             ‚Üê –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
‚îú‚îÄ‚îÄ ü§ù –ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç—ã           ‚Üê –ò–ù–ù ‚Üí –ö–∞—Ç–µ–≥–æ—Ä–∏—è (–æ–±—É—á–µ–Ω–∏–µ AI)
‚îú‚îÄ‚îÄ üè¢ –Æ—Ä–ª–∏—Ü–∞                ‚Üê –Æ—Ä–ª–∏—Ü–∞ –∏ –ò–ü –≥—Ä—É–ø–ø—ã
‚îÇ
‚îú‚îÄ‚îÄ üìä P&L –ø–æ –º–µ—Å—è—Ü–∞–º        ‚Üê –§–æ—Ä–º—É–ª—å–Ω—ã–π –ª–∏—Å—Ç (auto)
‚îú‚îÄ‚îÄ üí∞ Cash Flow             ‚Üê –û—Å—Ç–∞—Ç–∫–∏ –ø–æ —Å—á–µ—Ç–∞–º (auto)
‚îî‚îÄ‚îÄ üîç –ù–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ      ‚Üê –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –±–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (auto)
```

---

## –õ–∏—Å—Ç "–ñ—É—Ä–Ω–∞–ª —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π"

–ì–ª–∞–≤–Ω—ã–π –ª–∏—Å—Ç. –°—é–¥–∞ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –í–°–ï —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏–∑ –≤—Å–µ—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤.

### –°—Ö–µ–º–∞ –∫–æ–ª–æ–Ω–æ–∫

| # | –ö–æ–ª–æ–Ω–∫–∞ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|---|---------|-----|----------|--------|
| A | tx_id | String | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ | `MODUL-2025-01-03-587585` |
| B | date | Date | –î–∞—Ç–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏ | `03.01.2025` |
| C | entity | String | –Æ—Ä–ª–∏—Ü–æ (–∏–∑ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞) | `–ò–ü –ü–∏—Ä–æ–∂–∫–æ–≤–∞ –ù.–í.` |
| D | bank | String | –ù–∞–∑–≤–∞–Ω–∏–µ –±–∞–Ω–∫–∞ | `–ú–æ–¥—É–ª—å–±–∞–Ω–∫` |
| E | account | String | –ù–æ–º–µ—Ä —Å—á—ë—Ç–∞ | `40802810570010435344` |
| F | direction | String | IN –∏–ª–∏ OUT | `OUT` |
| G | amount | Number | –°—É–º–º–∞ (–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–∞—è) | `49499.53` |
| H | currency | String | –í–∞–ª—é—Ç–∞ | `RUB` |
| I | counterparty | String | –ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç | `–ö–∞–∑–Ω–∞—á–µ–π—Å—Ç–≤–æ –†–æ—Å—Å–∏–∏` |
| J | counterparty_inn | String | –ò–ù–ù –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞ | `7727406020` |
| K | purpose | String | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞ | `–ï–ù–° –∑–∞ —è–Ω–≤–∞—Ä—å 2025` |
| L | category | String | –ö–∞—Ç–µ–≥–æ—Ä–∏—è —Ä–∞—Å—Ö–æ–¥–∞/–¥–æ—Ö–æ–¥–∞ | `–ù–∞–ª–æ–≥–∏` |
| M | ai_confidence | Number | –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å AI (0-1) | `0.95` |
| N | is_internal | Boolean | –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –ø–µ—Ä–µ–≤–æ–¥? | `FALSE` |
| O | source | String | –ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö | `bank_statement` |
| P | financebot_id | String | ID –∑–∞—è–≤–∫–∏ FinanceBot | `REQ-20250103-143000-A1B2` |
| Q | month | String | –ú–µ—Å—è—Ü (—Ñ–æ—Ä–º—É–ª–∞) | `2025-01` |
| R | imported_at | DateTime | –î–∞—Ç–∞ –∏–º–ø–æ—Ä—Ç–∞ | `19.02.2026 15:30` |
| S | notes | String | –ü—Ä–∏–º–µ—á–∞–Ω–∏—è | `` |

### –§–æ—Ä–º—É–ª—ã –¥–ª—è –∞–≤—Ç–æ-–≤—ã—á–∏—Å–ª—è–µ–º—ã—Ö –∫–æ–ª–æ–Ω–æ–∫

```
–ö–æ–ª–æ–Ω–∫–∞ Q (month): =TEXT(B2,"YYYY-MM")
–ö–æ–ª–æ–Ω–∫–∞ A (tx_id): –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ, –Ω–µ —Ñ–æ—Ä–º—É–ª–∞
```

### –ü—Ä–∞–≤–∏–ª–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ ID

```python
def generate_tx_id(bank: str, doc_number: str, date: str, account: str) -> str:
    """
    –§–æ—Ä–º–∞—Ç: BANK-YYYY-MM-DD-DOCNUM
    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –∏–º–ø–æ—Ä—Ç–µ.
    """
    bank_code = {
        "–ú–æ–¥—É–ª—å–±–∞–Ω–∫": "MODUL",
        "–°–±–µ—Ä–±–∞–Ω–∫": "SBER",
        "–¢-–ë–∏–∑–Ω–µ—Å": "TBANK",
        "WB –ë–∞–Ω–∫": "WB",
        "–û–∑–æ–Ω –ë–∞–Ω–∫": "OZON",
        "FinanceBot": "FBOT",
    }.get(bank, bank[:5].upper())

    return f"{bank_code}-{date}-{doc_number}"
```

---

## –õ–∏—Å—Ç "–°—á–µ—Ç–∞"

–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –≤—Å–µ—Ö –±–∞–Ω–∫–æ–≤—Å–∫–∏—Ö —Å—á–µ—Ç–æ–≤ –≥—Ä—É–ø–ø—ã.

| –ö–æ–ª–æ–Ω–∫–∞ | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|---------|----------|--------|
| account_number | –ù–æ–º–µ—Ä —Ä/—Å | `40802810570010435344` |
| entity | –Æ—Ä–ª–∏—Ü–æ | `–ò–ü –ü–∏—Ä–æ–∂–∫–æ–≤–∞ –ù.–í.` |
| bank | –ë–∞–Ω–∫ | `–ú–æ–¥—É–ª—å–±–∞–Ω–∫` |
| currency | –í–∞–ª—é—Ç–∞ | `RUB` |
| purpose | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | `–û—Å–Ω–æ–≤–Ω–æ–π —Ä/—Å WB` |
| is_active | –ê–∫—Ç–∏–≤–µ–Ω? | `TRUE` |
| opening_date | –î–∞—Ç–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è | `01.01.2024` |

---

## –õ–∏—Å—Ç "–Æ—Ä–ª–∏—Ü–∞"

| –ö–æ–ª–æ–Ω–∫–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| entity_id | –ö–æ—Ä–æ—Ç–∫–∏–π –∫–æ–¥ (`IP_PIROZHKOVA`) |
| full_name | –ü–æ–ª–Ω–æ–µ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ |
| inn | –ò–ù–ù |
| type | `–ò–ü` / `–û–û–û` / `–ê–û` |
| group | –ì—Ä—É–ø–ø–∞ (`–û—Å–Ω–æ–≤–Ω–∞—è`) |
| is_active | –ê–∫—Ç–∏–≤–Ω–æ? |

### –ü—Ä–∞–≤–∏–ª–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –ø–µ—Ä–µ–≤–æ–¥–æ–≤

–ï—Å–ª–∏ –ò–ù–ù –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –ò–ù–ù –ª—é–±–æ–≥–æ –∏–∑ —é—Ä–ª–∏—Ü –≤ —ç—Ç–æ–º –ª–∏—Å—Ç–µ ‚Üí `is_internal = TRUE`, –∫–∞—Ç–µ–≥–æ—Ä–∏—è = `–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –ø–µ—Ä–µ–≤–æ–¥`.

---

## –õ–∏—Å—Ç "–ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç—ã"

–û–±—É—á–∞—é—â–∞—è –±–∞–∑–∞ –¥–ª—è AI –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ç–æ—Ä–∞. –ü–æ–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º.

| –ö–æ–ª–æ–Ω–∫–∞ | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|---------|----------|--------|
| inn | –ò–ù–ù | `7727406020` |
| name | –ù–∞–∑–≤–∞–Ω–∏–µ | `–§–ù–° –†–æ—Å—Å–∏–∏` |
| category | –ö–∞—Ç–µ–≥–æ—Ä–∏—è | `–ù–∞–ª–æ–≥–∏` |
| added_date | –î–∞—Ç–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è | `03.01.2025` |
| added_by | –ö—Ç–æ –¥–æ–±–∞–≤–∏–ª | `bot_auto` |

**–ü—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏:**
```
7727406020 | –§–ù–° –†–æ—Å—Å–∏–∏ / –ö–∞–∑–Ω–∞—á–µ–π—Å—Ç–≤–æ | –ù–∞–ª–æ–≥–∏ | system
7730176610 | –§–°–° –†–§ | –ù–∞–ª–æ–≥–∏ | system
7703363868 | –ü–§–† | –ù–∞–ª–æ–≥–∏ | system
```

---

## Python: –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–∞–±–ª–∏—Ü—ã

```python
import gspread
from google.oauth2.service_account import Credentials
from pathlib import Path
import logging

logger = logging.getLogger(__name__)

SCOPES = [
    "https://www.googleapis.com/auth/spreadsheets",
    "https://www.googleapis.com/auth/drive",
]

# –ó–∞–≥–æ–ª–æ–≤–∫–∏ –ª–∏—Å—Ç–∞ "–ñ—É—Ä–Ω–∞–ª —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π"
JOURNAL_HEADERS = [
    "tx_id", "date", "entity", "bank", "account", "direction",
    "amount", "currency", "counterparty", "counterparty_inn",
    "purpose", "category", "ai_confidence", "is_internal",
    "source", "financebot_id", "month", "imported_at", "notes"
]

ACCOUNTS_HEADERS = [
    "account_number", "entity", "bank", "currency",
    "purpose", "is_active", "opening_date"
]

ENTITIES_HEADERS = [
    "entity_id", "full_name", "inn", "type", "group", "is_active"
]

COUNTERPARTIES_HEADERS = [
    "inn", "name", "category", "added_date", "added_by"
]

CATEGORIES_HEADERS = [
    "category", "description", "type"  # type: income/expense/neutral
]

# –ù–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
INITIAL_CATEGORIES = [
    ["–ù–∞–ª–æ–≥–∏", "–ü–ª–∞—Ç–µ–∂–∏ –≤ –§–ù–°, –ü–§–†, –§–°–°, —Å—Ç—Ä–∞—Ö–æ–≤—ã–µ –≤–∑–Ω–æ—Å—ã, –ï–ù–°", "expense"],
    ["–ë–∞–Ω–∫–æ–≤—Å–∫–∏–µ —Ä–∞—Å—Ö–æ–¥—ã", "–ö–æ–º–∏—Å—Å–∏–∏ –±–∞–Ω–∫–∞, –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ —Å—á—ë—Ç–∞", "expense"],
    ["–ó–∞—Ä–ø–ª–∞—Ç–∞", "–í—ã–ø–ª–∞—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º –ø–æ —Ç—Ä—É–¥–æ–≤—ã–º –¥–æ–≥–æ–≤–æ—Ä–∞–º", "expense"],
    ["–ü–æ–¥—Ä—è–¥—á–∏–∫–∏", "–ò–ü –∏ —Å–∞–º–æ–∑–∞–Ω—è—Ç—ã–µ, –¥–æ–≥–æ–≤–æ—Ä—ã –ì–ü–•", "expense"],
    ["–ê—Ä–µ–Ω–¥–∞", "–û—Ñ–∏—Å, —Å–∫–ª–∞–¥, –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ", "expense"],
    ["–ó–∞–∫—É–ø–∫–∏", "–¢–æ–≤–∞—Ä—ã –¥–ª—è –ø–µ—Ä–µ–ø—Ä–æ–¥–∞–∂–∏, —Å—ã—Ä—å—ë", "expense"],
    ["–õ–æ–≥–∏—Å—Ç–∏–∫–∞", "–î–æ—Å—Ç–∞–≤–∫–∞, —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç, —Ñ—É–ª—Ñ–∏–ª–º–µ–Ω—Ç", "expense"],
    ["–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥", "–†–µ–∫–ª–∞–º–∞, –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ, PR", "expense"],
    ["–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è", "–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è, —ç–∫—Å–ø–µ—Ä—Ç–∏–∑—ã", "expense"],
    ["IT –∏ —Å–µ—Ä–≤–∏—Å—ã", "SaaS, —Ö–æ—Å—Ç–∏–Ω–≥, –¥–æ–º–µ–Ω—ã, –ü–û", "expense"],
    ["–û—Ñ–∏—Å", "–•–æ–∑–Ω—É–∂–¥—ã, –∫–∞–Ω—Ü–µ–ª—è—Ä–∏—è, —É–±–æ—Ä–∫–∞", "expense"],
    ["–í—ã—Ä—É—á–∫–∞", "–û–ø–ª–∞—Ç—ã –æ—Ç –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π –∑–∞ —Ç–æ–≤–∞—Ä—ã/—É—Å–ª—É–≥–∏", "income"],
    ["–ü—Ä–æ—á–∏–µ –¥–æ—Ö–æ–¥—ã", "–í–æ–∑–≤—Ä–∞—Ç—ã, –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–∏, –ø—Ä–æ—á–∏–µ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è", "income"],
    ["–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –ø–µ—Ä–µ–≤–æ–¥", "–ü–µ—Ä–µ–≤–æ–¥—ã –º–µ–∂–¥—É —Å—á–µ—Ç–∞–º–∏ –∏ —é—Ä–ª–∏—Ü–∞–º–∏ –≥—Ä—É–ø–ø—ã", "neutral"],
    ["–î–∏–≤–∏–¥–µ–Ω–¥—ã/–≤—ã–≤–æ–¥", "–í—ã–≤–æ–¥ –ø—Ä–∏–±—ã–ª–∏ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–∏–∫—É", "neutral"],
    ["–ü—Ä–æ—á–µ–µ", "–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é", "unknown"],
]

# –ü—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç—ã (—Å–∏—Å—Ç–µ–º–Ω—ã–µ –ò–ù–ù)
INITIAL_COUNTERPARTIES = [
    ["7727406020", "–ö–∞–∑–Ω–∞—á–µ–π—Å—Ç–≤–æ –†–æ—Å—Å–∏–∏ (–§–ù–° –†–æ—Å—Å–∏–∏)", "–ù–∞–ª–æ–≥–∏", "2024-01-01", "system"],
    ["7730176610", "–§–æ–Ω–¥ —Å–æ—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏—è –†–§", "–ù–∞–ª–æ–≥–∏", "2024-01-01", "system"],
    ["7703363868", "–ü–µ–Ω—Å–∏–æ–Ω–Ω—ã–π —Ñ–æ–Ω–¥ –†–æ—Å—Å–∏–∏", "–ù–∞–ª–æ–≥–∏", "2024-01-01", "system"],
    ["7736050003", "–°–æ—Ü–∏–∞–ª—å–Ω—ã–π —Ñ–æ–Ω–¥ –†–æ—Å—Å–∏–∏ (–°–§–†)", "–ù–∞–ª–æ–≥–∏", "2024-01-01", "system"],
]


def setup_financial_journal(
    spreadsheet_id: str,
    credentials_path: Path,
) -> gspread.Spreadsheet:
    """
    –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ª–∏—Å—Ç–æ–≤ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π Google Spreadsheet.

    Args:
        spreadsheet_id: ID —Ç–∞–±–ª–∏—Ü—ã (–∏–∑ URL)
        credentials_path: –ü—É—Ç—å –∫ service_account.json

    Returns:
        –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è gspread.Spreadsheet
    """
    creds = Credentials.from_service_account_file(credentials_path, scopes=SCOPES)
    gc = gspread.authorize(creds)
    spreadsheet = gc.open_by_key(spreadsheet_id)

    sheets_to_create = {
        "–ñ—É—Ä–Ω–∞–ª —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π": JOURNAL_HEADERS,
        "–°—á–µ—Ç–∞": ACCOUNTS_HEADERS,
        "–Æ—Ä–ª–∏—Ü–∞": ENTITIES_HEADERS,
        "–ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç—ã": COUNTERPARTIES_HEADERS,
        "–ö–∞—Ç–µ–≥–æ—Ä–∏–∏": CATEGORIES_HEADERS,
    }

    existing = {ws.title for ws in spreadsheet.worksheets()}

    for sheet_name, headers in sheets_to_create.items():
        if sheet_name not in existing:
            ws = spreadsheet.add_worksheet(title=sheet_name, rows=1000, cols=len(headers) + 2)
            ws.append_row(headers)
            logger.info(f"–°–æ–∑–¥–∞–Ω –ª–∏—Å—Ç: {sheet_name}")
        else:
            logger.info(f"–õ–∏—Å—Ç —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç: {sheet_name}")

    # –ó–∞–ø–æ–ª–Ω—è–µ–º —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏
    _seed_sheet(spreadsheet, "–ö–∞—Ç–µ–≥–æ—Ä–∏–∏", INITIAL_CATEGORIES)
    _seed_sheet(spreadsheet, "–ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç—ã", INITIAL_COUNTERPARTIES)

    logger.info("–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–≥–æ –∂—É—Ä–Ω–∞–ª–∞ –≥–æ—Ç–æ–≤–∞")
    return spreadsheet


def _seed_sheet(spreadsheet: gspread.Spreadsheet, sheet_name: str, rows: list) -> None:
    """–ó–∞–ø–æ–ª–Ω–∏—Ç—å –ª–∏—Å—Ç –Ω–∞—á–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –µ—Å–ª–∏ –æ–Ω –ø—É—Å—Ç–æ–π."""
    ws = spreadsheet.worksheet(sheet_name)
    existing_rows = ws.get_all_values()
    if len(existing_rows) <= 1:  # —Ç–æ–ª—å–∫–æ –∑–∞–≥–æ–ª–æ–≤–æ–∫
        ws.append_rows(rows)
        logger.info(f"–ó–∞–ø–æ–ª–Ω–µ–Ω —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ {sheet_name}: {len(rows)} –∑–∞–ø–∏—Å–µ–π")
```

---

## Python: –ó–∞–ø–∏—Å—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

```python
from datetime import datetime
from decimal import Decimal
from typing import List

def write_transactions_to_journal(
    spreadsheet: gspread.Spreadsheet,
    transactions: list,  # List[BankTransaction] –∏–∑ bank-statement-parser
    categories: list,    # List[CategoryResult] –∏–∑ transaction-categorizer
    entity_name: str,
    source: str = "bank_statement",
) -> tuple[int, int]:
    """
    –ó–∞–ø–∏—Å–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ –∂—É—Ä–Ω–∞–ª —Å –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–µ–π.

    Returns:
        (written_count, skipped_count)
    """
    ws = spreadsheet.worksheet("–ñ—É—Ä–Ω–∞–ª —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π")

    # –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ tx_id –¥–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏
    existing_ids = set(ws.col_values(1)[1:])  # –ö–æ–ª–æ–Ω–∫–∞ A –±–µ–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞

    rows_to_write = []
    skipped = 0

    for tx, cat in zip(transactions, categories):
        tx_id = generate_tx_id(tx.bank_name, tx.doc_number, tx.date.isoformat(), tx.account_number)

        if tx_id in existing_ids:
            skipped += 1
            continue

        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –ø–µ—Ä–µ–≤–æ–¥
        is_internal = cat.category == "–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –ø–µ—Ä–µ–≤–æ–¥"

        row = [
            tx_id,
            tx.date.strftime("%d.%m.%Y"),
            entity_name,
            tx.bank_name,
            tx.account_number,
            tx.direction,
            float(tx.amount),
            tx.currency,
            tx.counterparty_name,
            tx.counterparty_inn or "",
            tx.purpose,
            cat.category,
            cat.confidence,
            "TRUE" if is_internal else "FALSE",
            source,
            "",  # financebot_id ‚Äî –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏ —Å—à–∏–≤–∫–µ
            "",  # month ‚Äî —Ñ–æ—Ä–º—É–ª–∞ –≤ Sheets
            datetime.now().strftime("%d.%m.%Y %H:%M"),
            "",  # notes
        ]
        rows_to_write.append(row)

    if rows_to_write:
        ws.append_rows(rows_to_write, value_input_option="USER_ENTERED")

    logger.info(f"–ó–∞–ø–∏—Å–∞–Ω–æ: {len(rows_to_write)}, –ø—Ä–æ–ø—É—â–µ–Ω–æ –¥—É–±–ª–µ–π: {skipped}")
    return len(rows_to_write), skipped


def get_inn_category_cache(spreadsheet: gspread.Spreadsheet) -> dict[str, str]:
    """–ó–∞–≥—Ä—É–∑–∏—Ç—å –∫—ç—à –ò–ù–ù‚Üí–ö–∞—Ç–µ–≥–æ—Ä–∏—è –∏–∑ –ª–∏—Å—Ç–∞ –ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç—ã."""
    ws = spreadsheet.worksheet("–ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç—ã")
    rows = ws.get_all_values()[1:]  # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
    return {row[0]: row[2] for row in rows if len(row) >= 3 and row[0]}
```

---

## –§–æ—Ä–º—É–ª—ã –¥–ª—è P&L –ª–∏—Å—Ç–∞

```
# –†–∞—Å—Ö–æ–¥—ã –∑–∞ –º–µ—Å—è—Ü –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–≤–≤–µ–¥–∏ –≤ —è—á–µ–π–∫—É P&L –ª–∏—Å—Ç–∞)
=SUMPRODUCT(
  (–ñ—É—Ä–Ω–∞–ª —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π!F:F="OUT") *
  (–ñ—É—Ä–Ω–∞–ª —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π!L:L="–ù–∞–ª–æ–≥–∏") *
  (–ñ—É—Ä–Ω–∞–ª —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π!Q:Q="2025-01") *
  (–ñ—É—Ä–Ω–∞–ª —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π!N:N=FALSE) *
  –ñ—É—Ä–Ω–∞–ª —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π!G:G
)

# –í—ã—Ä—É—á–∫–∞ –∑–∞ –º–µ—Å—è—Ü
=SUMPRODUCT(
  (–ñ—É—Ä–Ω–∞–ª —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π!F:F="IN") *
  (–ñ—É—Ä–Ω–∞–ª —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π!L:L="–í—ã—Ä—É—á–∫–∞") *
  (–ñ—É—Ä–Ω–∞–ª —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π!Q:Q="2025-01") *
  –ñ—É—Ä–Ω–∞–ª —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π!G:G
)
```

---

## –°–≤—è–∑–∞–Ω–Ω—ã–µ —Å–∫–∏–ª–ª—ã

- `/bank-statement-parser` ‚Äî –ü–∞—Ä—Å–∏–Ω–≥ –≤—ã–ø–∏—Å–æ–∫ (–∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö)
- `/transaction-categorizer` ‚Äî –ö–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è (–Ω—É–∂–Ω–∞ –ø–µ—Ä–µ–¥ –∑–∞–ø–∏—Å—å—é)
- `/bank-import-bot` ‚Äî Telegram-–∫–æ–º–∞–Ω–¥—ã –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏
- `/financial-dashboard` ‚Äî Dashboard –∏ –æ—Ç—á—ë—Ç–Ω–æ—Å—Ç—å –ø–æ–≤–µ—Ä—Ö —ç—Ç–æ–π —Å—Ö–µ–º—ã
