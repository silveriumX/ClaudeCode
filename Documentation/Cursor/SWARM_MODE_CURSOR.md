# Swarm-режим в Cursor — аналог Claude Code Swarm

Краткое сравнение Claude Code Swarm и возможностей Cursor, плюс как настроить «Swarm» у себя.

---

## Claude Code Swarm vs Cursor

| Возможность | Claude Code Swarm | Cursor |
|-------------|------------------|--------|
| **Несколько специализированных агентов** | TeammateTool, субагенты с разными ролями | **Subagents** — агенты в `.cursor/agents/` (architect, sheets, verifier, testing-agent и т.д.) |
| **Параллельная работа** | Delegate Mode, фоновые агенты (Ctrl+B) | Subagents: **Foreground** (ждать ответ) или **Background** (сразу вернуть управление, субагент работает параллельно) |
| **Изоляция контекста** | У каждого агента свой контекст | У каждого **subagent** свой контекст; родительский агент получает только итог |
| **Координатор** | Оркестратор распределяет задачи | Родительский **Agent** делегирует задачам субагентам (в т.ч. наш **orchestrator**) |
| **Один запрос — много моделей** | — | **Parallel Agents (worktrees)** — один промпт, несколько моделей, потом выбор лучшего (Best-of-N) |
| **Изоляция файлов** | — | **Worktrees** — каждый параллельный агент в своём git worktree, без конфликтов правок |

Итог: в Cursor «Swarm» дают **Subagents** (делегирование + параллель в фоне) и при необходимости **Parallel Agents / worktrees** (один запрос, несколько моделей).

---

## 1. Subagents — основа «Swarm» в Cursor

Subagents — это субагенты, которым основной Agent может делегировать задачи. Они описаны в [Cursor Docs → Subagents](https://cursor.com/docs/context/subagents).

- Каждый subagent работает в **своём контексте** (не забивает основной чат).
- Можно запускать **несколько subagents параллельно** (режим **Background**).
- Наши файлы в `.cursor/agents/` (orchestrator, financebot-architect, financebot-sheets, testing-agent, coding-agent, verifier и т.д.) — это и есть **кастомные subagents**. Cursor подхватывает их автоматически.

Как это даёт «Swarm»:

- Ты даёшь одну задачу основному агенту (или оркестратору).
- Агент **делегирует** части работы разным subagents (например: architect — спецификация, testing-agent — план тестов, coding-agent — реализация).
- Часть субагентов можно запускать в **Background**, чтобы они шли параллельно; родитель потом собирает результаты.

Практически: в одном чате написать что-то вроде:

- *«Используй orchestrator: разбей задачу [X] и по возможности делегируй subagents (architect, testing-agent, coding-agent) — часть в фоне, потом объедини результат.»*

Либо без оркестратора:

- *«Для задачи [X]: параллельно запусти subagent financebot-architect (спецификация) и subagent testing-agent (план тестов и зависимости) в фоне, затем объедини вывод.»*

Так ты получаешь «несколько специализированных агентов работают параллельно» как в Swarm.

---

## 2. Режимы Subagents: Foreground и Background

Из документации Cursor:

| Режим | Поведение | Когда использовать |
|-------|-----------|---------------------|
| **Foreground** | Родитель ждёт завершения subagent, потом получает ответ | Нужен результат по шагу (например, сначала спецификация, потом по ней код). |
| **Background** | Родитель сразу получает управление; subagent работает отдельно | Параллельные независимые задачи (например, план тестов и чеклист деплоя одновременно). |

Чтобы часть работы шла «Swarm-ом» параллельно, нужно явно просить запускать субагентов **в фоне (background)** там, где задачи независимы.

---

## 3. Parallel Agents (worktrees) — Best-of-N

Отдельная фича: **один и тот же промпт** выполняется несколькими агентами (разные модели или несколько копий) в изолированных **worktrees**. Ты потом выбираешь лучший результат и применяешь его (Apply).

- Включение: в интерфейсе агента выбрать запуск в **worktree** и при необходимости несколько моделей (Best-of-N).
- Настройка окружения для каждого worktree: `.cursor/worktrees.json` (у тебя уже есть `setup-worktree` / `setup-worktree-windows` — копирование `.env` и т.д.).

Это не «разные роли как в Swarm», а «несколько попыток одной задачи → выбрать лучшую». Для Swarm-подобного разделения ролей важнее Subagents (п. 1).

---

## 4. Что уже есть у тебя в репозитории

- **Агенты (subagents):** `.cursor/agents/` — orchestrator, coding-agent, testing-agent, verifier, financebot-architect, financebot-sheets, financebot-handlers, financebot-verifier, financebot-deploy.
- **Индекс и параллель:** `.cursor/agents/INDEX.md` — список агентов и раздел «Использование нескольких агентов параллельно».
- **Worktrees:** `.cursor/worktrees.json` — копирование `.env` в worktree при необходимости.

Этого достаточно, чтобы пользоваться «Swarm» через Subagents и при желании — через Parallel Agents.

---

## 5. Как включить Swarm-режим в Cursor (кратко)

1. **Через Subagents (рекомендуется)**
   В одном чате с агентом:
   - Сформулировать задачу и попросить делегировать части на наших subagents (orchestrator, architect, testing-agent, coding-agent, verifier и т.д.).
   - Для параллельной работы явно попросить: *«запусти subagent X и subagent Y в фоне (background), потом объедини результаты»*.

2. **Через оркестратора**
   Написать что-то вроде:
   *«Orchestrator в режиме Swarm: задача [X]. Разбей на подзадачи и делегируй architect, sheets, handlers, testing-agent — где можно параллельно в фоне, в конце объединённый итог.»*
   Оркестратор описан так, чтобы он мог «вызывать» других агентов; в Cursor это и есть делегирование subagents.

3. **Best-of-N по одной задаче**
   В Composer/Agent выбрать запуск в worktree и несколько моделей — получишь несколько вариантов решения, выберешь лучший (Apply).
   Настройка окружения для worktrees уже есть в `.cursor/worktrees.json`.

4. **Ограничения**
   - Subagents не «запускаются» отдельными процессами на твоей машине — их запускает родительский агент Cursor в рамках своего контекста и правил.
   - Параллельность — через режим Background у subagents и/или через несколько чатов вручную (как в INDEX.md).
   - Точное воспроизведение Claude TeammateTool (несколько полностью независимых процессов) в Cursor так не реализуется — максимально близко: Subagents + Background + при необходимости несколько чатов.

---

## 6. Полезные ссылки

- [Cursor Docs — Subagents](https://cursor.com/docs/context/subagents)
- [Cursor Docs — Parallel Agents (worktrees)](https://cursor.com/docs/configuration/worktrees)
- Локально: `.cursor/agents/INDEX.md` — список агентов и «Использование нескольких агентов параллельно».

Если нужно, можно добавить в `.cursor/rules/` правило, которое при фразе «Swarm»/«параллельно агенты» подсказывает агенту делегировать subagents и использовать Background там, где задачи независимы.
