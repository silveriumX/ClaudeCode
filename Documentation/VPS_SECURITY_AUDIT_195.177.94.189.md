# Отчёт проверки безопасности VPS 195.177.94.189

**Дата проверки:** 28 января 2026
**ОС:** Ubuntu 22.04, ядро 5.15.0-84-generic
**Uptime:** ~11 дней

---

## Критические уязвимости

### 1. Нет firewall (UFW и iptables)

- **UFW:** `Status: inactive`
- **iptables:** политика ACCEPT для INPUT/FORWARD/OUTPUT, правил нет

**Риск:** Любой порт, открытый на сервере, доступен из интернета. Сейчас открыты SSH (22) и приложение на 8765.

**Рекомендация:** Включить UFW и разрешить только нужные порты:

```bash
ufw default deny incoming
ufw default allow outgoing
ufw allow 22/tcp    # SSH
ufw allow 8765/tcp  # только если порт 8765 должен быть снаружи; иначе не открывать
ufw enable
ufw status verbose
```

Если порт 8765 нужен только локально или через reverse proxy — не открывать его в UFW и слушать только `127.0.0.1`.

---

### 2. SSH: вход root по паролю + массовый брутфорс

- **PermitRootLogin yes** — вход под root разрешён.
- **PasswordAuthentication yes** — вход по паролю включён.

В логах видна активная подборка паролей (неудачные попытки за сегодня):

- Пользователи: `admin`, `root`, `socksuser`, `vbox`, `web01`, `User3`, `user`, `jenkins`, `dev`, `mysql`, `nas`, `mailuser`, `guest`, `vmail`, `celery`, `vpntest`, `localadmin`, `vpsuser`
- IP: 176.120.22.13, 187.16.96.250, 81.9.158.147, 218.4.91.162, 45.148.10.121, 101.47.140.127 и др.

**Риск:** При слабом или утёкшем пароле root возможен полный захват сервера.

**Рекомендации:**

1. Установить и настроить **fail2ban** (бан после нескольких неудачных попыток):

   ```bash
   apt install fail2ban -y
   systemctl enable fail2ban
   systemctl start fail2ban
   # по умолчанию jail для sshd уже есть
   ```

2. Перейти на вход по **ключу**, отключить пароль для SSH:

   - На своей машине: `ssh-copy-id root@195.177.94.189` (или добавить свой `id_rsa.pub` в `~/.ssh/authorized_keys` на сервере).
   - Убедиться, что вход по ключу работает.
   - В `/etc/ssh/sshd_config` выставить:
     - `PasswordAuthentication no`
     - `PermitRootLogin prohibit-password` (или `no`, если будете заходить под обычным пользователем с sudo).
   - Перезапуск: `systemctl restart sshd`.

3. Опционально сменить порт SSH (например, с 22 на другой) и в UFW открыть только этот порт — уменьшает шум и автоматический брутфорс по 22.

---

### 3. Слабый sudo: NOPASSWD для ubuntu и test

- В `/etc/sudoers.d/90-cloud-init-users`:
  - `ubuntu ALL=(ALL) NOPASSWD:ALL`
  - `test ALL=(ALL) NOPASSWD:ALL`

**Риск:** Любой, кто получит доступ под `ubuntu` или `test` (взлом пароля, утечка сессии), получает root без пароля.

**Рекомендации:**

- Удалить пользователя **test**, если он не нужен:
  `userdel -r test` (после проверки, что ничего важного от него не зависит).
- Для **ubuntu**: по возможности убрать NOPASSWD и перейти на пароль или только ключи для входа. Минимум — убедиться, что у ubuntu надёжный пароль и вход только по ключу.

---

## Важные замечания

### 4. Открытый порт 8765 (Python)

- Слушает на `0.0.0.0:8765` (доступен из интернета).
- Процесс: `python3` (по списку сервисов — вероятно, CursorBridge или другой бот/API).

**Риск:** Если там веб-интерфейс или API без аутентификации, возможен несанкционированный доступ.

**Рекомендация:** Выяснить, что за сервис. Если доступ снаружи не нужен — в настройках приложения перевести listen на `127.0.0.1:8765` и в UFW порт 8765 не открывать. Если доступ нужен — добавить аутентификацию/HTTPS и в UFW открыть только 8765 (или проксировать через nginx с HTTPS и авторизацией).

---

### 5. Обновления системы

- Есть пакеты с доступными обновлениями (в т.ч. `libc6`, `libc-bin` и др.).

**Рекомендация:** Регулярно обновляться:

```bash
apt update && apt upgrade -y
```

Проверить, что включены автоматические security-обновления (unattended-upgrades уже установлен — убедиться, что он включён и не отключён в конфиге).

---

### 6. Ядро и образ ОС

- Ядро: 5.15.0-84 (сборка Sep 2023). Для Ubuntu 22.04 обычно выходят более новые ядра с исправлениями безопасности.

**Рекомендация:** После `apt update && apt upgrade` проверить, установилось ли новое ядро; при необходимости перезагрузить сервер в удобное окно.

---

## Что в порядке

- Всего два пользователя с shell: **root** и **ubuntu** (плюс возможный **test** в sudoers — его лучше убрать).
- Лишних сервисов не видно: в основном systemd, ваши боты (voice_bot, finance_bot, cursor_bridge и т.д.), ssh, cron, rsyslog.
- Cron у root без подозрительных заданий (только стандартные).
- DNS (порт 53) слушает только localhost (127.0.0.53) — нормально.

---

## ✅ Применено (28.01.2026)

- **UFW:** включён, разрешены только 22/tcp и 8765/tcp.
- **Fail2ban:** установлен и запущен, jail `sshd` активен.
- **Обновления:** выполнены `apt update && apt upgrade`.
- **Пользователь test:** в системе не было — ничего не меняли.
- **SSH по паролю:** оставлен включённым, т.к. в `/root/.ssh/authorized_keys` нет ключей (отключение пароля привело бы к потере доступа). Чтобы отключить вход по паролю:
  1. Добавьте свой ключ: `ssh-copy-id root@195.177.94.189` (или вручную вставьте содержимое `~/.ssh/id_rsa.pub` в `/root/.ssh/authorized_keys` на сервере).
  2. Проверьте вход по ключу.
  3. Включите отключение пароля и перезапустите скрипт или вручную: `PasswordAuthentication no`, `PermitRootLogin prohibit-password` в `/etc/ssh/sshd_config`, затем `systemctl restart ssh`.

---

## Краткий чеклист действий

| Приоритет | Действие |
|-----------|----------|
| Высокий   | Включить UFW, разрешить только 22 (и при необходимости 8765). |
| Высокий   | Установить и включить fail2ban. |
| Высокий   | Перейти на вход по SSH-ключу и отключить PasswordAuthentication. |
| Высокий   | Удалить пользователя `test` или убрать ему NOPASSWD. |
| Средний   | Проверить сервис на порту 8765: нужен ли доступ снаружи, есть ли авторизация. |
| Средний   | Выполнить `apt update && apt upgrade`, при необходимости перезагрузка. |
| Низкий    | Рассмотреть смену порта SSH и запрет входа root по паролю (PermitRootLogin prohibit-password). |

---

## Одной командой (минимальная защита)

После того как убедитесь, что вход по **ключу** работает, на сервере можно выполнить:

```bash
# Firewall
ufw default deny incoming
ufw default allow outgoing
ufw allow 22/tcp
# ufw allow 8765/tcp   # раскомментировать только если порт 8765 нужен снаружи
ufw --force enable

# Fail2ban
apt install -y fail2ban
systemctl enable fail2ban
systemctl start fail2ban

# Обновления
apt update && apt upgrade -y
```

Дальше вручную: настроить sshd (ключи, отключение пароля), убрать/ограничить пользователя test и проверить сервис на 8765.
